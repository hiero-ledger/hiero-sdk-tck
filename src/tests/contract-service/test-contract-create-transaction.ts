import { assert, expect } from "chai";

import { JSONRPCRequest } from "@services/Client";
import mirrorNodeClient from "@services/MirrorNodeClient";
import consensusInfoClient from "@services/ConsensusInfoClient";

import { setOperator } from "@helpers/setup-tests";
import { retryOnError } from "@helpers/retry-on-error";

import { createAccount } from "@helpers/account";
import {
  generateEd25519PrivateKey,
  generateEd25519PublicKey,
  generateEcdsaSecp256k1PrivateKey,
  generateEcdsaSecp256k1PublicKey,
  generateKeyList,
} from "@helpers/key";
import {
  verifyContractKey,
  verifyContractKeyList,
  verifyContractUpdateWithNullKey,
} from "@helpers/verify-contract-tx";
import { invalidKey } from "@constants/key-type";

import { ErrorStatusCodes } from "@enums/error-status-codes";
import { ContractFunctionParameters } from "@hashgraph/sdk";

const smartContractBytecode =
  "608060405234801561001057600080fd5b50336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506101cb806100606000396000f3fe608060405260043610610046576000357c01000000000000000000000000000000000000000000000000000000009004806341c0e1b51461004b578063cfae321714610062575b600080fd5b34801561005757600080fd5b506100606100f2565b005b34801561006e57600080fd5b50610077610162565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156100b757808201518184015260208101905061009c565b50505050905090810190601f1680156100e45780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415610160573373ffffffffffffffffffffffffffffffffffffffff16ff5b565b60606040805190810160405280600d81526020017f48656c6c6f2c20776f726c64210000000000000000000000000000000000000081525090509056fea165627a7a72305820ae96fb3af7cde9c0abfe365272441894ab717f816f07f41f07b1cbede54e256e0029";

/**
 * Tests for ContractCreateTransaction
 */
describe.only("ContractCreateTransaction", function () {
  this.timeout(30000);

  beforeEach(async function () {
    await setOperator(
      this,
      process.env.OPERATOR_ACCOUNT_ID as string,
      process.env.OPERATOR_ACCOUNT_PRIVATE_KEY as string,
    );
  });

  afterEach(async function () {
    await JSONRPCRequest(this, "reset");
  });

  const toHexString = (byteArray: Uint8Array) => {
    return Array.from(byteArray, function (byte) {
      return ("0" + (byte & 0xff).toString(16)).slice(-2);
    }).join("");
  };

  describe("Bytecode File Id", function () {
    const gas = "300000";
    it("(#1) reate a contract with valid file containing bytecode", async function () {
      const fileResponse = await JSONRPCRequest(this, "createFile", {
        contents: smartContractBytecode,
      });
      const fileId = fileResponse.fileId;

      const response = await JSONRPCRequest(this, "createContract", {
        bytecodeFileId: fileId,
        gas,
      });

      expect(response.status).to.equal("SUCCESS");

      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.contractId.toString()).to.equal(response.contractId);
    });

    it("(#2) Create a contract with `bytecodeFileId` which contains incorrect `bytecode`(`0x60006000fe`)", async function () {
      const fileResponse = await JSONRPCRequest(this, "createFile", {
        contents: "0x60006000fe",
      });
      const fileId = fileResponse.fileId;

      try {
        await JSONRPCRequest(this, "createContract", {
          bytecodeFileId: fileId,
          gas,
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "CONTRACT_EXECUTION_EXCEPTION",
          "Invalid bytecode error",
        );
        return;
      }
      assert.fail("Should throw an error");
    });

    it("(#3) Create a contract with `bytecodeFileId` which does not exist", async function () {
      const fileId = "0.0.1234567890";

      try {
        await JSONRPCRequest(this, "createContract", {
          bytecodeFileId: fileId,
          gas,
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "INVALID_FILE_ID",
          "Invalid file id error",
        );
        return;
      }
      assert.fail("Should throw an error");
    });

    it("(#4) Create a contract with a valid file ID but no content", async function () {
      const fileResponse = await JSONRPCRequest(this, "createFile", {
        contents: "",
      });
      const fileId = fileResponse.fileId;

      try {
        await JSONRPCRequest(this, "createContract", {
          bytecodeFileId: fileId,
          gas,
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "CONTRACT_FILE_EMPTY",
          "Contract file empty error",
        );
        return;
      }
      assert.fail("Should throw an error");
    });

    it("(#5) Create and deploy a valid ERC-20 contract", async function () {
      const fileCreateEd25519PrivateKey = await generateEd25519PrivateKey(this);
      const fileCreateEd25519PublicKey = await generateEd25519PublicKey(
        this,
        fileCreateEd25519PrivateKey,
      );
      const erc20Bytecode =
        "608060405234801561000f575f5ffd5b506040516115dc3803806115dc833981810160405281019061003191906103aa565b6040518060400160405280600481526020017f476f6c64000000000000000000000000000000000000000000000000000000008152506040518060400160405280600381526020017f474c44000000000000000000000000000000000000000000000000000000000081525081600390816100ac9190610609565b5080600490816100bc9190610609565b5050506100cf33826100d560201b60201c565b506107ed565b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603610145575f6040517fec442f0500000000000000000000000000000000000000000000000000000000815260040161013c9190610717565b60405180910390fd5b6101565f838361015a60201b60201c565b5050565b5f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff16036101aa578060025f82825461019e919061075d565b92505081905550610278565b5f5f5f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2054905081811015610233578381836040517fe450d38c00000000000000000000000000000000000000000000000000000000815260040161022a9392919061079f565b60405180910390fd5b8181035f5f8673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2081905550505b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16036102bf578060025f8282540392505081905550610309565b805f5f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f82825401925050819055505b8173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef8360405161036691906107d4565b60405180910390a3505050565b5f5ffd5b5f819050919050565b61038981610377565b8114610393575f5ffd5b50565b5f815190506103a481610380565b92915050565b5f602082840312156103bf576103be610373565b5b5f6103cc84828501610396565b91505092915050565b5f81519050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f600282049050600182168061045057607f821691505b6020821081036104635761046261040c565b5b50919050565b5f819050815f5260205f209050919050565b5f6020601f8301049050919050565b5f82821b905092915050565b5f600883026104c57fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8261048a565b6104cf868361048a565b95508019841693508086168417925050509392505050565b5f819050919050565b5f61050a61050561050084610377565b6104e7565b610377565b9050919050565b5f819050919050565b610523836104f0565b61053761052f82610511565b848454610496565b825550505050565b5f5f905090565b61054e61053f565b61055981848461051a565b505050565b5b8181101561057c576105715f82610546565b60018101905061055f565b5050565b601f8211156105c15761059281610469565b61059b8461047b565b810160208510156105aa578190505b6105be6105b68561047b565b83018261055e565b50505b505050565b5f82821c905092915050565b5f6105e15f19846008026105c6565b1980831691505092915050565b5f6105f983836105d2565b9150826002028217905092915050565b610612826103d5565b67ffffffffffffffff81111561062b5761062a6103df565b5b6106358254610439565b610640828285610580565b5f60209050601f831160018114610671575f841561065f578287015190505b61066985826105ee565b8655506106d0565b601f19841661067f86610469565b5f5b828110156106a657848901518255600182019150602085019450602081019050610681565b868310156106c357848901516106bf601f8916826105d2565b8355505b6001600288020188555050505b505050505050565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f610701826106d8565b9050919050565b610711816106f7565b82525050565b5f60208201905061072a5f830184610708565b92915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f61076782610377565b915061077283610377565b925082820190508082111561078a57610789610730565b5b92915050565b61079981610377565b82525050565b5f6060820190506107b25f830186610708565b6107bf6020830185610790565b6107cc6040830184610790565b949350505050565b5f6020820190506107e75f830184610790565b92915050565b610de2806107fa5f395ff3fe608060405234801561000f575f5ffd5b5060043610610091575f3560e01c8063313ce56711610064578063313ce5671461013157806370a082311461014f57806395d89b411461017f578063a9059cbb1461019d578063dd62ed3e146101cd57610091565b806306fdde0314610095578063095ea7b3146100b357806318160ddd146100e357806323b872dd14610101575b5f5ffd5b61009d6101fd565b6040516100aa9190610a5b565b60405180910390f35b6100cd60048036038101906100c89190610b0c565b61028d565b6040516100da9190610b64565b60405180910390f35b6100eb6102af565b6040516100f89190610b8c565b60405180910390f35b61011b60048036038101906101169190610ba5565b6102b8565b6040516101289190610b64565b60405180910390f35b6101396102e6565b6040516101469190610c10565b60405180910390f35b61016960048036038101906101649190610c29565b6102ee565b6040516101769190610b8c565b60405180910390f35b610187610333565b6040516101949190610a5b565b60405180910390f35b6101b760048036038101906101b29190610b0c565b6103c3565b6040516101c49190610b64565b60405180910390f35b6101e760048036038101906101e29190610c54565b6103e5565b6040516101f49190610b8c565b60405180910390f35b60606003805461020c90610cbf565b80601f016020809104026020016040519081016040528092919081815260200182805461023890610cbf565b80156102835780601f1061025a57610100808354040283529160200191610283565b820191905f5260205f20905b81548152906001019060200180831161026657829003601f168201915b5050505050905090565b5f5f610297610467565b90506102a481858561046e565b600191505092915050565b5f600254905090565b5f5f6102c2610467565b90506102cf858285610480565b6102da858585610513565b60019150509392505050565b5f6012905090565b5f5f5f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20549050919050565b60606004805461034290610cbf565b80601f016020809104026020016040519081016040528092919081815260200182805461036e90610cbf565b80156103b95780601f10610390576101008083540402835291602001916103b9565b820191905f5260205f20905b81548152906001019060200180831161039c57829003601f168201915b5050505050905090565b5f5f6103cd610467565b90506103da818585610513565b600191505092915050565b5f60015f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2054905092915050565b5f33905090565b61047b8383836001610603565b505050565b5f61048b84846103e5565b90507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff81101561050d57818110156104fe578281836040517ffb8f41b20000000000000000000000000000000000000000000000000000000081526004016104f593929190610cfe565b60405180910390fd5b61050c84848484035f610603565b5b50505050565b5f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603610583575f6040517f96c6fd1e00000000000000000000000000000000000000000000000000000000815260040161057a9190610d33565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16036105f3575f6040517fec442f050000000000000000000000000000000000000000000000000000000081526004016105ea9190610d33565b60405180910390fd5b6105fe8383836107d2565b505050565b5f73ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff1603610673575f6040517fe602df0500000000000000000000000000000000000000000000000000000000815260040161066a9190610d33565b60405180910390fd5b5f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff16036106e3575f6040517f94280d620000000000000000000000000000000000000000000000000000000081526004016106da9190610d33565b60405180910390fd5b8160015f8673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f208190555080156107cc578273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925846040516107c39190610b8c565b60405180910390a35b50505050565b5f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1603610822578060025f8282546108169190610d79565b925050819055506108f0565b5f5f5f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20549050818110156108ab578381836040517fe450d38c0000000000000000000000000000000000000000000000000000000081526004016108a293929190610cfe565b60405180910390fd5b8181035f5f8673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f2081905550505b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603610937578060025f8282540392505081905550610981565b805f5f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f82825401925050819055505b8173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef836040516109de9190610b8c565b60405180910390a3505050565b5f81519050919050565b5f82825260208201905092915050565b8281835e5f83830152505050565b5f601f19601f8301169050919050565b5f610a2d826109eb565b610a3781856109f5565b9350610a47818560208601610a05565b610a5081610a13565b840191505092915050565b5f6020820190508181035f830152610a738184610a23565b905092915050565b5f5ffd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f610aa882610a7f565b9050919050565b610ab881610a9e565b8114610ac2575f5ffd5b50565b5f81359050610ad381610aaf565b92915050565b5f819050919050565b610aeb81610ad9565b8114610af5575f5ffd5b50565b5f81359050610b0681610ae2565b92915050565b5f5f60408385031215610b2257610b21610a7b565b5b5f610b2f85828601610ac5565b9250506020610b4085828601610af8565b9150509250929050565b5f8115159050919050565b610b5e81610b4a565b82525050565b5f602082019050610b775f830184610b55565b92915050565b610b8681610ad9565b82525050565b5f602082019050610b9f5f830184610b7d565b92915050565b5f5f5f60608486031215610bbc57610bbb610a7b565b5b5f610bc986828701610ac5565b9350506020610bda86828701610ac5565b9250506040610beb86828701610af8565b9150509250925092565b5f60ff82169050919050565b610c0a81610bf5565b82525050565b5f602082019050610c235f830184610c01565b92915050565b5f60208284031215610c3e57610c3d610a7b565b5b5f610c4b84828501610ac5565b91505092915050565b5f5f60408385031215610c6a57610c69610a7b565b5b5f610c7785828601610ac5565b9250506020610c8885828601610ac5565b9150509250929050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f6002820490506001821680610cd657607f821691505b602082108103610ce957610ce8610c92565b5b50919050565b610cf881610a9e565b82525050565b5f606082019050610d115f830186610cef565b610d1e6020830185610b7d565b610d2b6040830184610b7d565b949350505050565b5f602082019050610d465f830184610cef565b92915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601160045260245ffd5b5f610d8382610ad9565b9150610d8e83610ad9565b9250828201905080821115610da657610da5610d4c565b5b9291505056fea26469706673582212203210f5624e6037bb3a7d2b8a4f84f21b119eb900c6a8b8ca15be637bc43c6fa664736f6c634300081e0033";

      const fileResponse = await JSONRPCRequest(this, "createFile", {
        keys: [fileCreateEd25519PublicKey],
        contents: erc20Bytecode.substring(0, 5800),
        commonTransactionParams: {
          signers: [fileCreateEd25519PrivateKey],
        },
      });
      const fileId = fileResponse.fileId;

      const appendResponse = await JSONRPCRequest(this, "appendFile", {
        keys: [fileCreateEd25519PublicKey],
        fileId,
        contents: erc20Bytecode.substring(5800),
        commonTransactionParams: {
          signers: [fileCreateEd25519PrivateKey],
        },
      });
      expect(appendResponse.status).to.equal("SUCCESS");

      const constructorParameters = new ContractFunctionParameters()
        .addUint256(1)
        ._build();

      const response = await JSONRPCRequest(this, "createContract", {
        bytecodeFileId: fileId,
        gas: "1000000",
        constructorParameters: toHexString(constructorParameters),
        commonTransactionParams: {
          signers: [fileCreateEd25519PrivateKey],
        },
      });
      expect(response.status).to.equal("SUCCESS");

      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.contractId.toString()).to.equal(response.contractId);
    });

    it("(#6) Create and deploy a valid ERC-721 contract", async function () {
      const fileCreateEd25519PrivateKey = await generateEd25519PrivateKey(this);
      const fileCreateEd25519PublicKey = await generateEd25519PublicKey(
        this,
        fileCreateEd25519PrivateKey,
      );
      const erc721Bytecode =
        "608060405234801561000f575f5ffd5b506040518060400160405280600881526020017f47616d654974656d0000000000000000000000000000000000000000000000008152506040518060400160405280600381526020017f49544d0000000000000000000000000000000000000000000000000000000000815250815f908161008a91906102df565b50806001908161009a91906102df565b5050506103ae565b5f81519050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f600282049050600182168061011d57607f821691505b6020821081036101305761012f6100d9565b5b50919050565b5f819050815f5260205f209050919050565b5f6020601f8301049050919050565b5f82821b905092915050565b5f600883026101927fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82610157565b61019c8683610157565b95508019841693508086168417925050509392505050565b5f819050919050565b5f819050919050565b5f6101e06101db6101d6846101b4565b6101bd565b6101b4565b9050919050565b5f819050919050565b6101f9836101c6565b61020d610205826101e7565b848454610163565b825550505050565b5f5f905090565b610224610215565b61022f8184846101f0565b505050565b5b81811015610252576102475f8261021c565b600181019050610235565b5050565b601f8211156102975761026881610136565b61027184610148565b81016020851015610280578190505b61029461028c85610148565b830182610234565b50505b505050565b5f82821c905092915050565b5f6102b75f198460080261029c565b1980831691505092915050565b5f6102cf83836102a8565b9150826002028217905092915050565b6102e8826100a2565b67ffffffffffffffff811115610301576103006100ac565b5b61030b8254610106565b610316828285610256565b5f60209050601f831160018114610347575f8415610335578287015190505b61033f85826102c4565b8655506103a6565b601f19841661035586610136565b5f5b8281101561037c57848901518255600182019150602085019450602081019050610357565b868310156103995784890151610395601f8916826102a8565b8355505b6001600288020188555050505b505050505050565b612286806103bb5f395ff3fe608060405234801561000f575f5ffd5b50600436106100e8575f3560e01c806370a082311161008a578063b88d4fde11610064578063b88d4fde14610258578063c87b56dd14610274578063cf378343146102a4578063e985e9c5146102d4576100e8565b806370a08231146101ee57806395d89b411461021e578063a22cb4651461023c576100e8565b8063095ea7b3116100c6578063095ea7b31461016a57806323b872dd1461018657806342842e0e146101a25780636352211e146101be576100e8565b806301ffc9a7146100ec57806306fdde031461011c578063081812fc1461013a575b5f5ffd5b610106600480360381019061010191906117ca565b610304565b604051610113919061180f565b60405180910390f35b610124610364565b6040516101319190611898565b60405180910390f35b610154600480360381019061014f91906118eb565b6103f3565b6040516101619190611955565b60405180910390f35b610184600480360381019061017f9190611998565b61040e565b005b6101a0600480360381019061019b91906119d6565b610424565b005b6101bc60048036038101906101b791906119d6565b610523565b005b6101d860048036038101906101d391906118eb565b610542565b6040516101e59190611955565b60405180910390f35b61020860048036038101906102039190611a26565b610553565b6040516102159190611a60565b60405180910390f35b610226610609565b6040516102339190611898565b60405180910390f35b61025660048036038101906102519190611aa3565b610699565b005b610272600480360381019061026d9190611c0d565b6106af565b005b61028e600480360381019061028991906118eb565b6106d4565b60405161029b9190611898565b60405180910390f35b6102be60048036038101906102b99190611d2b565b6107df565b6040516102cb9190611a60565b60405180910390f35b6102ee60048036038101906102e99190611d85565b610815565b6040516102fb919061180f565b60405180910390f35b5f634906490660e01b7bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916148061035d575061035c826108a3565b5b9050919050565b60605f805461037290611df0565b80601f016020809104026020016040519081016040528092919081815260200182805461039e90611df0565b80156103e95780601f106103c0576101008083540402835291602001916103e9565b820191905f5260205f20905b8154815290600101906020018083116103cc57829003601f168201915b5050505050905090565b5f6103fd82610984565b5061040782610a0a565b9050919050565b610420828261041b610a43565b610a4a565b5050565b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603610494575f6040517f64a0ae9200000000000000000000000000000000000000000000000000000000815260040161048b9190611955565b60405180910390fd5b5f6104a783836104a2610a43565b610a5c565b90508373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161461051d578382826040517f64283d7b00000000000000000000000000000000000000000000000000000000815260040161051493929190611e20565b60405180910390fd5b50505050565b61053d83838360405180602001604052805f8152506106af565b505050565b5f61054c82610984565b9050919050565b5f5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16036105c4575f6040517f89c62b640000000000000000000000000000000000000000000000000000000081526004016105bb9190611955565b60405180910390fd5b60035f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f20549050919050565b60606001805461061890611df0565b80601f016020809104026020016040519081016040528092919081815260200182805461064490611df0565b801561068f5780601f106106665761010080835404028352916020019161068f565b820191905f5260205f20905b81548152906001019060200180831161067257829003601f168201915b5050505050905090565b6106ab6106a4610a43565b8383610c67565b5050565b6106ba848484610424565b6106ce6106c5610a43565b85858585610dd0565b50505050565b60606106df82610984565b505f60065f8481526020019081526020015f2080546106fd90611df0565b80601f016020809104026020016040519081016040528092919081815260200182805461072990611df0565b80156107745780601f1061074b57610100808354040283529160200191610774565b820191905f5260205f20905b81548152906001019060200180831161075757829003601f168201915b505050505090505f610784610f7c565b90505f8151036107985781925050506107da565b5f825111156107cc5780826040516020016107b4929190611e8f565b604051602081830303815290604052925050506107da565b6107d584610f92565b925050505b919050565b5f5f6107eb6007610ff8565b90506107f78482611004565b61080181846110f7565b61080b6007611151565b8091505092915050565b5f60055f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f9054906101000a900460ff16905092915050565b5f7f80ac58cd000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916148061096d57507f5b5e139f000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916145b8061097d575061097c82611165565b5b9050919050565b5f5f61098f836111ce565b90505f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1603610a0157826040517f7e2732890000000000000000000000000000000000000000000000000000000081526004016109f89190611a60565b60405180910390fd5b80915050919050565b5f60045f8381526020019081526020015f205f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050919050565b5f33905090565b610a578383836001611207565b505050565b5f5f610a67846111ce565b90505f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff1614610aa857610aa78184866113c6565b5b5f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1614610b3357610ae75f855f5f611207565b600160035f8373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f82825403925050819055505b5f73ffffffffffffffffffffffffffffffffffffffff168573ffffffffffffffffffffffffffffffffffffffff1614610bb257600160035f8773ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f82825401925050819055505b8460025f8681526020019081526020015f205f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550838573ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef60405160405180910390a4809150509392505050565b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603610cd757816040517f5b08ba18000000000000000000000000000000000000000000000000000000008152600401610cce9190611955565b60405180910390fd5b8060055f8573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f8473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020015f205f6101000a81548160ff0219169083151502179055508173ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff167f17307eab39ab6107e8899845ad3d59bd9653f200f220920489ca2b5937696c3183604051610dc3919061180f565b60405180910390a3505050565b5f8373ffffffffffffffffffffffffffffffffffffffff163b1115610f75578273ffffffffffffffffffffffffffffffffffffffff1663150b7a02868685856040518563ffffffff1660e01b8152600401610e2e9493929190611f04565b6020604051808303815f875af1925050508015610e6957506040513d601f19601f82011682018060405250810190610e669190611f62565b60015b610eea573d805f8114610e97576040519150601f19603f3d011682016040523d82523d5f602084013e610e9c565b606091505b505f815103610ee257836040517f64a0ae92000000000000000000000000000000000000000000000000000000008152600401610ed99190611955565b60405180910390fd5b805160208201fd5b63150b7a0260e01b7bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916817bffffffffffffffffffffffffffffffffffffffffffffffffffffffff191614610f7357836040517f64a0ae92000000000000000000000000000000000000000000000000000000008152600401610f6a9190611955565b60405180910390fd5b505b5050505050565b606060405180602001604052805f815250905090565b6060610f9d82610984565b505f610fa7610f7c565b90505f815111610fc55760405180602001604052805f815250610ff0565b80610fcf84611489565b604051602001610fe0929190611e8f565b6040516020818303038152906040525b915050919050565b5f815f01549050919050565b5f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1603611074575f6040517f64a0ae9200000000000000000000000000000000000000000000000000000000815260040161106b9190611955565b60405180910390fd5b5f61108083835f610a5c565b90505f73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff16146110f2575f6040517f73c6ac6e0000000000000000000000000000000000000000000000000000000081526004016110e99190611955565b60405180910390fd5b505050565b8060065f8481526020019081526020015f209081611115919061212d565b507ff8e1a15aba9398e019f0b49df1a4fde98ee17ae345cb5f6b5e2c27f5033e8ce7826040516111459190611a60565b60405180910390a15050565b6001815f015f828254019250508190555050565b5f7f01ffc9a7000000000000000000000000000000000000000000000000000000007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916827bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916149050919050565b5f60025f8381526020019081526020015f205f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050919050565b808061123f57505f73ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1614155b15611371575f61124e84610984565b90505f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff16141580156112b857508273ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1614155b80156112cb57506112c98184610815565b155b1561130d57826040517fa9fbf51f0000000000000000000000000000000000000000000000000000000081526004016113049190611955565b60405180910390fd5b811561136f57838573ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff167f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b92560405160405180910390a45b505b8360045f8581526020019081526020015f205f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050505050565b6113d1838383611553565b611484575f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff160361144557806040517f7e27328900000000000000000000000000000000000000000000000000000000815260040161143c9190611a60565b60405180910390fd5b81816040517f177e802f00000000000000000000000000000000000000000000000000000000815260040161147b9291906121fc565b60405180910390fd5b505050565b60605f600161149784611613565b0190505f8167ffffffffffffffff8111156114b5576114b4611ae9565b5b6040519080825280601f01601f1916602001820160405280156114e75781602001600182028036833780820191505090505b5090505f82602083010190505b600115611548578080600190039150507f3031323334353637383961626364656600000000000000000000000000000000600a86061a8153600a858161153d5761153c612223565b5b0494505f85036114f4575b819350505050919050565b5f5f73ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff161415801561160a57508273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff1614806115cb57506115ca8484610815565b5b8061160957508273ffffffffffffffffffffffffffffffffffffffff166115f183610a0a565b73ffffffffffffffffffffffffffffffffffffffff16145b5b90509392505050565b5f5f5f90507a184f03e93ff9f4daa797ed6e38ed64bf6a1f010000000000000000831061166f577a184f03e93ff9f4daa797ed6e38ed64bf6a1f010000000000000000838161166557611664612223565b5b0492506040810190505b6d04ee2d6d415b85acef810000000083106116ac576d04ee2d6d415b85acef810000000083816116a2576116a1612223565b5b0492506020810190505b662386f26fc1000083106116db57662386f26fc1000083816116d1576116d0612223565b5b0492506010810190505b6305f5e1008310611704576305f5e10083816116fa576116f9612223565b5b0492506008810190505b612710831061172957612710838161171f5761171e612223565b5b0492506004810190505b6064831061174c576064838161174257611741612223565b5b0492506002810190505b600a831061175b576001810190505b80915050919050565b5f604051905090565b5f5ffd5b5f5ffd5b5f7fffffffff0000000000000000000000000000000000000000000000000000000082169050919050565b6117a981611775565b81146117b3575f5ffd5b50565b5f813590506117c4816117a0565b92915050565b5f602082840312156117df576117de61176d565b5b5f6117ec848285016117b6565b91505092915050565b5f8115159050919050565b611809816117f5565b82525050565b5f6020820190506118225f830184611800565b92915050565b5f81519050919050565b5f82825260208201905092915050565b8281835e5f83830152505050565b5f601f19601f8301169050919050565b5f61186a82611828565b6118748185611832565b9350611884818560208601611842565b61188d81611850565b840191505092915050565b5f6020820190508181035f8301526118b08184611860565b905092915050565b5f819050919050565b6118ca816118b8565b81146118d4575f5ffd5b50565b5f813590506118e5816118c1565b92915050565b5f60208284031215611900576118ff61176d565b5b5f61190d848285016118d7565b91505092915050565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f61193f82611916565b9050919050565b61194f81611935565b82525050565b5f6020820190506119685f830184611946565b92915050565b61197781611935565b8114611981575f5ffd5b50565b5f813590506119928161196e565b92915050565b5f5f604083850312156119ae576119ad61176d565b5b5f6119bb85828601611984565b92505060206119cc858286016118d7565b9150509250929050565b5f5f5f606084860312156119ed576119ec61176d565b5b5f6119fa86828701611984565b9350506020611a0b86828701611984565b9250506040611a1c868287016118d7565b9150509250925092565b5f60208284031215611a3b57611a3a61176d565b5b5f611a4884828501611984565b91505092915050565b611a5a816118b8565b82525050565b5f602082019050611a735f830184611a51565b92915050565b611a82816117f5565b8114611a8c575f5ffd5b50565b5f81359050611a9d81611a79565b92915050565b5f5f60408385031215611ab957611ab861176d565b5b5f611ac685828601611984565b9250506020611ad785828601611a8f565b9150509250929050565b5f5ffd5b5f5ffd5b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b611b1f82611850565b810181811067ffffffffffffffff82111715611b3e57611b3d611ae9565b5b80604052505050565b5f611b50611764565b9050611b5c8282611b16565b919050565b5f67ffffffffffffffff821115611b7b57611b7a611ae9565b5b611b8482611850565b9050602081019050919050565b828183375f83830152505050565b5f611bb1611bac84611b61565b611b47565b905082815260208101848484011115611bcd57611bcc611ae5565b5b611bd8848285611b91565b509392505050565b5f82601f830112611bf457611bf3611ae1565b5b8135611c04848260208601611b9f565b91505092915050565b5f5f5f5f60808587031215611c2557611c2461176d565b5b5f611c3287828801611984565b9450506020611c4387828801611984565b9350506040611c54878288016118d7565b925050606085013567ffffffffffffffff811115611c7557611c74611771565b5b611c8187828801611be0565b91505092959194509250565b5f67ffffffffffffffff821115611ca757611ca6611ae9565b5b611cb082611850565b9050602081019050919050565b5f611ccf611cca84611c8d565b611b47565b905082815260208101848484011115611ceb57611cea611ae5565b5b611cf6848285611b91565b509392505050565b5f82601f830112611d1257611d11611ae1565b5b8135611d22848260208601611cbd565b91505092915050565b5f5f60408385031215611d4157611d4061176d565b5b5f611d4e85828601611984565b925050602083013567ffffffffffffffff811115611d6f57611d6e611771565b5b611d7b85828601611cfe565b9150509250929050565b5f5f60408385031215611d9b57611d9a61176d565b5b5f611da885828601611984565b9250506020611db985828601611984565b9150509250929050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f6002820490506001821680611e0757607f821691505b602082108103611e1a57611e19611dc3565b5b50919050565b5f606082019050611e335f830186611946565b611e406020830185611a51565b611e4d6040830184611946565b949350505050565b5f81905092915050565b5f611e6982611828565b611e738185611e55565b9350611e83818560208601611842565b80840191505092915050565b5f611e9a8285611e5f565b9150611ea68284611e5f565b91508190509392505050565b5f81519050919050565b5f82825260208201905092915050565b5f611ed682611eb2565b611ee08185611ebc565b9350611ef0818560208601611842565b611ef981611850565b840191505092915050565b5f608082019050611f175f830187611946565b611f246020830186611946565b611f316040830185611a51565b8181036060830152611f438184611ecc565b905095945050505050565b5f81519050611f5c816117a0565b92915050565b5f60208284031215611f7757611f7661176d565b5b5f611f8484828501611f4e565b91505092915050565b5f819050815f5260205f209050919050565b5f6020601f8301049050919050565b5f82821b905092915050565b5f60088302611fe97fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82611fae565b611ff38683611fae565b95508019841693508086168417925050509392505050565b5f819050919050565b5f61202e612029612024846118b8565b61200b565b6118b8565b9050919050565b5f819050919050565b61204783612014565b61205b61205382612035565b848454611fba565b825550505050565b5f5f905090565b612072612063565b61207d81848461203e565b505050565b5b818110156120a0576120955f8261206a565b600181019050612083565b5050565b601f8211156120e5576120b681611f8d565b6120bf84611f9f565b810160208510156120ce578190505b6120e26120da85611f9f565b830182612082565b50505b505050565b5f82821c905092915050565b5f6121055f19846008026120ea565b1980831691505092915050565b5f61211d83836120f6565b9150826002028217905092915050565b61213682611828565b67ffffffffffffffff81111561214f5761214e611ae9565b5b6121598254611df0565b6121648282856120a4565b5f60209050601f831160018114612195575f8415612183578287015190505b61218d8582612112565b8655506121f4565b601f1984166121a386611f8d565b5f5b828110156121ca578489015182556001820191506020850194506020810190506121a5565b868310156121e757848901516121e3601f8916826120f6565b8355505b6001600288020188555050505b505050505050565b5f60408201905061220f5f830185611946565b61221c6020830184611a51565b9392505050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52601260045260245ffdfea2646970667358221220f3046d11a7ab967677b72b58b77bbfbd063c9008e6bfeb91dd84e93e8c67137f64736f6c634300081e0033";

      const fileResponse = await JSONRPCRequest(this, "createFile", {
        keys: [fileCreateEd25519PublicKey],
        contents: erc721Bytecode.substring(0, 5800),
        commonTransactionParams: {
          signers: [fileCreateEd25519PrivateKey],
        },
      });
      const fileId = fileResponse.fileId;

      const appendResponse = await JSONRPCRequest(this, "appendFile", {
        keys: [fileCreateEd25519PublicKey],
        fileId,
        contents: erc721Bytecode.substring(5800),
        commonTransactionParams: {
          signers: [fileCreateEd25519PrivateKey],
        },
      });
      expect(appendResponse.status).to.equal("SUCCESS");

      const response = await JSONRPCRequest(this, "createContract", {
        bytecodeFileId: fileId,
        gas: "2500000",
        commonTransactionParams: {
          signers: [fileCreateEd25519PrivateKey],
        },
      });
      expect(response.status).to.equal("SUCCESS");

      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.contractId.toString()).to.equal(response.contractId);
    });

    it("(#7) Create and deploy a valid contract that uses the Hiero account service system contract", async function () {
      const fileCreateEd25519PrivateKey = await generateEd25519PrivateKey(this);
      const fileCreateEd25519PublicKey = await generateEd25519PublicKey(
        this,
        fileCreateEd25519PrivateKey,
      );
      const systemContractBytecode =
        "6080604052348015600e575f5ffd5b50610ec38061001c5f395ff3fe608060405234801561000f575f5ffd5b5060043610610055575f3560e01c806309d98c59146100595780631c0e502d1461008a57806360626c1a146100bb5780638bce4f7d146100ec578063f83479cb1461011d575b5f5ffd5b610073600480360381019061006e9190610989565b61014e565b6040516100819291906109de565b60405180910390f35b6100a4600480360381019061009f9190610989565b6101c6565b6040516100b2929190610a1f565b60405180910390f35b6100d560048036038101906100d09190610989565b61023e565b6040516100e39291906109de565b60405180910390f35b61010660048036038101906101019190610b82565b6102b6565b604051610114929190610a1f565b60405180910390f35b61013760048036038101906101329190610b82565b610320565b604051610145929190610a1f565b60405180910390f35b5f5f6101598361038a565b80925081935050507fa27cdbf2730224c9c11367703bc63bc3582fadeeb2bc00a48fa5230be0a2e2c482826040516101929291906109de565b60405180910390a1601660030b8260070b141580156101b85750601d60030b8260070b14155b156101c1575f5ffd5b915091565b5f5f6101d1836104a4565b80925081935050507f693ca0ebcfd96a65d10022521651984f4fe4eac5b025d2b76cb38487fbf979c8828260405161020a929190610a1f565b60405180910390a1601660030b8260070b141580156102305750601d60030b8260070b14155b15610239575f5ffd5b915091565b5f5f610249836105c0565b80925081935050507fa27cdbf2730224c9c11367703bc63bc3582fadeeb2bc00a48fa5230be0a2e2c482826040516102829291906109de565b60405180910390a1601660030b8260070b141580156102a85750600f60030b8260070b14155b156102b1575f5ffd5b915091565b5f5f6102c38585856106da565b8092508193505050601660030b8260070b146102dd575f5ffd5b7f162586be4b98b0928c37fb28878bf8924f5dd1eef9de96579d71ead76d8922d282868360405161031093929190610c0a565b60405180910390a1935093915050565b5f5f61032d8585856107fd565b8092508193505050601660030b8260070b14610347575f5ffd5b7f162586be4b98b0928c37fb28878bf8924f5dd1eef9de96579d71ead76d8922d282868360405161037a93929190610c0a565b60405180910390a1935093915050565b5f5f5f5f61016a73ffffffffffffffffffffffffffffffffffffffff1663bbf12d2e60e01b866040516024016103c09190610c3f565b604051602081830303815290604052907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff838183161783525050505060405161042a9190610caa565b5f604051808303815f865af19150503d805f8114610463576040519150601f19603f3d011682016040523d82523d5f602084013e610468565b606091505b50915091508161047a5760155f61048f565b8080602001905181019061048e9190610d31565b5b8160030b915080945081955050505050915091565b5f5f5f5f61016a73ffffffffffffffffffffffffffffffffffffffff1663308ef30160e01b866040516024016104da9190610c3f565b604051602081830303815290604052907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506040516105449190610caa565b5f604051808303815f865af19150503d805f811461057d576040519150601f19603f3d011682016040523d82523d5f602084013e610582565b606091505b5091509150816105945760155f6105ab565b6016818060200190518101906105aa9190610d99565b5b8160030b915080945081955050505050915091565b5f5f5f5f61016a73ffffffffffffffffffffffffffffffffffffffff1663dea3d08160e01b866040516024016105f69190610c3f565b604051602081830303815290604052907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506040516106609190610caa565b5f604051808303815f865af19150503d805f8114610699576040519150601f19603f3d011682016040523d82523d5f602084013e61069e565b606091505b5091509150816106b05760155f6106c5565b808060200190518101906106c49190610d31565b5b8160030b915080945081955050505050915091565b5f5f5f5f61016a73ffffffffffffffffffffffffffffffffffffffff1663b2a31da460e01b88888860405160240161071493929190610e0c565b604051602081830303815290604052907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff838183161783525050505060405161077e9190610caa565b5f604051808303815f865af19150503d805f81146107b7576040519150601f19603f3d011682016040523d82523d5f602084013e6107bc565b606091505b5091509150816107ce5760155f6107e5565b6016818060200190518101906107e49190610d99565b5b8160030b915080945081955050505050935093915050565b5f5f5f5f61016a73ffffffffffffffffffffffffffffffffffffffff1663b252636760e01b88888860405160240161083793929190610e0c565b604051602081830303815290604052907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506040516108a19190610caa565b5f604051808303815f865af19150503d805f81146108da576040519150601f19603f3d011682016040523d82523d5f602084013e6108df565b606091505b5091509150816108f15760155f610906565b808060200190518101906109059190610e4f565b5b8160030b915080945081955050505050935093915050565b5f604051905090565b5f5ffd5b5f5ffd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6109588261092f565b9050919050565b6109688161094e565b8114610972575f5ffd5b50565b5f813590506109838161095f565b92915050565b5f6020828403121561099e5761099d610927565b5b5f6109ab84828501610975565b91505092915050565b5f8160070b9050919050565b6109c9816109b4565b82525050565b6109d88161094e565b82525050565b5f6040820190506109f15f8301856109c0565b6109fe60208301846109cf565b9392505050565b5f8115159050919050565b610a1981610a05565b82525050565b5f604082019050610a325f8301856109c0565b610a3f6020830184610a10565b9392505050565b5f5ffd5b5f5ffd5b5f601f19601f8301169050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b610a9482610a4e565b810181811067ffffffffffffffff82111715610ab357610ab2610a5e565b5b80604052505050565b5f610ac561091e565b9050610ad18282610a8b565b919050565b5f67ffffffffffffffff821115610af057610aef610a5e565b5b610af982610a4e565b9050602081019050919050565b828183375f83830152505050565b5f610b26610b2184610ad6565b610abc565b905082815260208101848484011115610b4257610b41610a4a565b5b610b4d848285610b06565b509392505050565b5f82601f830112610b6957610b68610a46565b5b8135610b79848260208601610b14565b91505092915050565b5f5f5f60608486031215610b9957610b98610927565b5b5f610ba686828701610975565b935050602084013567ffffffffffffffff811115610bc757610bc661092b565b5b610bd386828701610b55565b925050604084013567ffffffffffffffff811115610bf457610bf361092b565b5b610c0086828701610b55565b9150509250925092565b5f606082019050610c1d5f8301866109c0565b610c2a60208301856109cf565b610c376040830184610a10565b949350505050565b5f602082019050610c525f8301846109cf565b92915050565b5f81519050919050565b5f81905092915050565b8281835e5f83830152505050565b5f610c8482610c58565b610c8e8185610c62565b9350610c9e818560208601610c6c565b80840191505092915050565b5f610cb58284610c7a565b915081905092915050565b5f8160030b9050919050565b610cd581610cc0565b8114610cdf575f5ffd5b50565b5f81519050610cf081610ccc565b92915050565b5f610d008261092f565b9050919050565b610d1081610cf6565b8114610d1a575f5ffd5b50565b5f81519050610d2b81610d07565b92915050565b5f5f60408385031215610d4757610d46610927565b5b5f610d5485828601610ce2565b9250506020610d6585828601610d1d565b9150509250929050565b610d7881610a05565b8114610d82575f5ffd5b50565b5f81519050610d9381610d6f565b92915050565b5f60208284031215610dae57610dad610927565b5b5f610dbb84828501610d85565b91505092915050565b5f82825260208201905092915050565b5f610dde82610c58565b610de88185610dc4565b9350610df8818560208601610c6c565b610e0181610a4e565b840191505092915050565b5f606082019050610e1f5f8301866109cf565b8181036020830152610e318185610dd4565b90508181036040830152610e458184610dd4565b9050949350505050565b5f5f60408385031215610e6557610e64610927565b5b5f610e7285828601610ce2565b9250506020610e8385828601610d85565b915050925092905056fea2646970667358221220f5d4b813845f7b86356120f7322adb29afcd0feccbbfd1cb7b71bde325e9fd4464736f6c634300081e0033";
      const fileResponse = await JSONRPCRequest(this, "createFile", {
        keys: [fileCreateEd25519PublicKey],
        contents: systemContractBytecode.substring(0, 5800),
        commonTransactionParams: {
          signers: [fileCreateEd25519PrivateKey],
        },
      });
      const fileId = fileResponse.fileId;

      const appendResponse = await JSONRPCRequest(this, "appendFile", {
        keys: [fileCreateEd25519PublicKey],
        fileId,
        contents: systemContractBytecode.substring(5800),
        commonTransactionParams: {
          signers: [fileCreateEd25519PrivateKey],
        },
      });
      expect(appendResponse.status).to.equal("SUCCESS");

      const response = await JSONRPCRequest(this, "createContract", {
        bytecodeFileId: fileId,
        gas: "1000000",
        commonTransactionParams: {
          signers: [fileCreateEd25519PrivateKey],
        },
      });
      expect(response.status).to.equal("SUCCESS");

      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.contractId.toString()).to.equal(response.contractId);
    });

    it("(#8) Create and deploy a valid contract that uses the Hiero token service system contract", async function () {
      const fileCreateEd25519PrivateKey = await generateEd25519PrivateKey(this);
      const fileCreateEd25519PublicKey = await generateEd25519PublicKey(
        this,
        fileCreateEd25519PrivateKey,
      );
      const systemContractBytecode =
        "608060405234801561001057600080fd5b50615afe80620000216000396000f3fe608060405234801561001057600080fd5b50600436106102de5760003560e01c80636552dd0a11610186578063bc2fb00e116100e3578063efe60aeb11610097578063f68a81bb11610071578063f68a81bb14610701578063fa5c222414610714578063fd4d1c261461072757600080fd5b8063efe60aeb146106ba578063f1e3aea2146106cd578063f429f19b146106e057600080fd5b8063c0395467116100c8578063c03954671461060d578063d3f67d271461065b578063ebe1e5fb146106a757600080fd5b8063bc2fb00e14610681578063bff9834f1461069457600080fd5b8063971f5a0b1161013a578063af4494fb1161011f578063af4494fb14610633578063b132f4941461065b578063b51f3cf51461066e57600080fd5b8063971f5a0b1461060d5780639b23d3d91461062057600080fd5b806385dec08e1161016b57806385dec08e146105c75780638e5e7996146105da578063911ce425146105fa57600080fd5b80636552dd0a1461055757806370a063641461059d57600080fd5b806335589a131161023f5780634dc21f9f116101f35780635b391493116101cd5780635b39149314610510578063618dc65e14610523578063622488631461054457600080fd5b80634dc21f9f146104ca578063565ca6fa146104dd57806359c16f5a146104f057600080fd5b80633cc2322f116102245780633cc2322f1461046557806344f38bc8146104785780634b27d1ac1461049a57600080fd5b806335589a13146104455780633717ec981461046557600080fd5b806325004c1c1161029657806330c4a1c61161027b57806330c4a1c6146103cb578063319a87231461040f5780633232fc9f1461043257600080fd5b806325004c1c146103a55780632b2f5c66146103b857600080fd5b806315dacbea116102c757806315dacbea1461033f5780631955de0b146103655780631de8edad1461038557600080fd5b8063045c5bfe146102e357806312fe05501461030c575b600080fd5b6102f66102f1366004613d8c565b61073a565b6040516103039190613e33565b60405180910390f35b61031f61031a366004613e46565b610843565b604080519485526020850193909352918301526060820152608001610303565b61035261034d366004613e87565b610c48565b60405160079190910b8152602001610303565b610378610373366004613ed8565b610d55565b6040516103039190613f6f565b610398610393366004613f82565b610dc9565b6040516103039190613f9f565b6102f66103b3366004613fd3565b610e09565b6102f66103c6366004613f82565b610ee8565b6103de6103d9366004613e87565b610fa8565b6040516103039594939291909415158552602085019390935290151560408401526060830152608082015260a00190565b61042261041d366004613f82565b61113d565b6040519015158152602001610303565b6102f6610440366004613ed8565b6111c6565b610458610453366004613f82565b6111f6565b60405161030391906143b9565b6102f6610473366004613e87565b61120a565b61048b610486366004613f82565b61130e565b604051610303939291906143cc565b6104ad6104a8366004614405565b611340565b604080519283526001600160a01b03909116602083015201610303565b61031f6104d8366004614558565b6114f8565b6104226104eb366004613fd3565b6117d0565b6105036104fe366004613f82565b611839565b604051610303919061462f565b6102f661051e366004614664565b61184d565b61053661053136600461471d565b61188a565b60405161030392919061476d565b6102f6610552366004613ed8565b6119a8565b61056a610565366004613e46565b6119d8565b604080516001600160a01b0395861681529385166020850152918416918301919091529091166060820152608001610303565b6105b06105ab366004613fd3565b611c88565b604080519215158352901515602083015201610303565b6102f66105d5366004613f82565b611d91565b6105ed6105e836600461478e565b611ea6565b60405161030391906147bc565b6102f6610608366004613e46565b611ebb565b6102f661061b366004613f82565b611f10565b61035261062e366004613e87565b611f7a565b610646610641366004614840565b611fd8565b60408051928352602083019190915201610303565b6102f6610669366004613f82565b6121dc565b6102f661067c366004614664565b612246565b61042261068f366004613fd3565b61229c565b6104226106a2366004613f82565b612305565b61031f6106b536600461489b565b61236d565b6105b06106c8366004613f82565b61253b565b6102f66106db366004613e46565b612655565b6106f36106ee366004613f82565b6126aa565b604051908152602001610303565b61031f61070f366004614558565b612715565b6102f6610722366004613ed8565b612962565b610422610735366004613f82565b612992565b6040516001600160a01b038316602482015281151560448201526060906000908190309063618dc65e9088907fa22cb46500000000000000000000000000000000000000000000000000000000906064015b60408051601f198184030181529181526020820180516001600160e01b03166001600160e01b03199485161790525160e085901b90921682526107d29291600401614979565b600060405180830381600087803b1580156107ec57600080fd5b505af1158015610800573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f1916820160405261082891908101906149e0565b90925090506016821461083a57600080fd5b95945050505050565b600080600080600060405161085790613c37565b604051809103906000f080158015610873573d6000803e3d6000fd5b50604051636eb1769f60e11b81523060048201526001600160a01b0380831660248301529192506000918a169063dd62ed3e9060440160206040518083038186803b1580156108c157600080fd5b505afa1580156108d5573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906108f99190614a1d565b6040516370a0823160e01b81526001600160a01b038a811660048301529192506000918b16906370a082319060240160206040518083038186803b15801561094057600080fd5b505afa158015610954573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906109789190614a1d565b905060006109878b858b6129f5565b90506109ab8160405180606001604052806021815260200161593d60219139612af9565b604051636eb1769f60e11b81523060048201526001600160a01b038581166024830152600091908d169063dd62ed3e9060440160206040518083038186803b1580156109f657600080fd5b505afa158015610a0a573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610a2e9190614a1d565b9050898114610a845760405162461bcd60e51b815260206004820152601360248201527f416c6c6f77616e6365206d69736d61746368210000000000000000000000000060448201526064015b60405180910390fd5b6040517f4444fbf70000000000000000000000000000000000000000000000000000000081526001600160a01b038d81166004830152602482018c90523060448301528c81166064830152861690634444fbf790608401600060405180830381600087803b158015610af557600080fd5b505af1158015610b09573d6000803e3d6000fd5b50505050610b2f8260405180606001604052806022815260200161598760229139612af9565b604051636eb1769f60e11b81523060048201526001600160a01b038681166024830152600091908e169063dd62ed3e9060440160206040518083038186803b158015610b7a57600080fd5b505afa158015610b8e573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610bb29190614a1d565b6040516370a0823160e01b81526001600160a01b038e811660048301529192506000918f16906370a082319060240160206040518083038186803b158015610bf957600080fd5b505afa158015610c0d573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610c319190614a1d565b959e949d50909b5093995091975050505050505050565b6040516001600160a01b0385811660248301528481166044830152831660648201526084810182905260009081908190610167907f15dacbea000000000000000000000000000000000000000000000000000000009060a4015b60408051601f198184030181529181526020820180516001600160e01b03166001600160e01b0319909416939093179092529051610ce09190614a36565b6000604051808303816000865af19150503d8060008114610d1d576040519150601f19603f3d011682016040523d82523d6000602084013e610d22565b606091505b509150915081610d33576015610d47565b80806020019051810190610d479190614a64565b60030b979650505050505050565b610d9b6040518060a0016040528060001515815260200160006001600160a01b03168152602001606081526020016060815260200160006001600160a01b031681525090565b600080610da88585612b1f565b915060070b9150601660030b8214610dbf57600080fd5b9150505b92915050565b604080516060810182526000808252602082018190529181018290529080610df084612c7c565b909250905060168214610e0257600080fd5b9392505050565b6040516001600160a01b03821660248201526060906000908190309063618dc65e9087906370a0823160e01b906044015b60408051601f198184030181529181526020820180516001600160e01b03166001600160e01b03199485161790525160e085901b9092168252610e809291600401614979565b600060405180830381600087803b158015610e9a57600080fd5b505af1158015610eae573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052610ed691908101906149e0565b909250905060168214610dbf57600080fd5b6040805160048082526024820183526020820180516001600160e01b03167f313ce5670000000000000000000000000000000000000000000000000000000017905291516330c6e32f60e11b81526060926000928392309263618dc65e92610f5292899201614979565b600060405180830381600087803b158015610f6c57600080fd5b505af1158015610f80573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052610df091908101906149e0565b6000806000806000806000806000806000610fc38f8e612d8d565b60070b9050611007816040518060400160405280601181526020017f4772616e74206b7963206661696c65642e000000000000000000000000000000815250612af9565b6110118f8e612e89565b965060070b9350601684146110685760405162461bcd60e51b815260206004820152601760248201527f4973206b7963206f7065726174696f6e206661696c65640000000000000000006044820152606401610a7b565b856110b55760405162461bcd60e51b815260206004820152601360248201527f4b796320737461747573206d69736d61746368000000000000000000000000006044820152606401610a7b565b6110bf8f8e612f7d565b60070b9050611103816040518060400160405280601281526020017f5265766f6b65206b7963206661696c65642e0000000000000000000000000000815250612af9565b61110f8f8f8f8f612fcc565b915061111b8f8e612e89565b969b5093995094975060079290920b9550909350505050945094509450945094565b600080600061114b8461302d565b909250905060168214610e025760405162461bcd60e51b815260206004820152602360248201527f676574546f6b656e44656661756c74467265657a65537461747573206661696c60448201527f65642100000000000000000000000000000000000000000000000000000000006064820152608401610a7b565b6060600080306001600160a01b031663618dc65e8663081812fc60e01b87604051602401610e3a91815260200190565b6111fe613c44565b600080610df08461312a565b604080516001600160a01b03858116602483015284166044820152606480820184905282518083039091018152608490910182526020810180516001600160e01b03167f23b872dd0000000000000000000000000000000000000000000000000000000017905290516330c6e32f60e11b81526060916000918291309163618dc65e9161129c918b9190600401614979565b600060405180830381600087803b1580156112b657600080fd5b505af11580156112ca573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f191682016040526112f291908101906149e0565b90925090506016821461130457600080fd5b9695505050505050565b6060806060600061131e85613213565b919650945092509050600781900b60161461133857600080fd5b509193909250565b600080600084118015611351575082155b156114185760006113638787876129f5565b90506113878160405180606001604052806021815260200161593d60219139612af9565b604051636eb1769f60e11b81523060048201526001600160a01b0387811660248301526000919089169063dd62ed3e9060440160206040518083038186803b1580156113d257600080fd5b505afa1580156113e6573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061140a9190614a1d565b9350600092506114ef915050565b6000611425878786613313565b9050611466816040518060400160405280601681526020017f4661696c656420746f20617070726f7665204e46542e00000000000000000000815250612af9565b60405163020604bf60e21b8152600481018590526000906001600160a01b0389169063081812fc9060240160206040518083038186803b1580156114a957600080fd5b505afa1580156114bd573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906114e19190614a8a565b6000945092506114ef915050565b94509492505050565b60008060008060008060008060008b60070b13801561151657508951155b1561159b576040516370a0823160e01b81526001600160a01b038a811660048301528d16906370a082319060240160206040518083038186803b15801561155c57600080fd5b505afa158015611570573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906115949190614a1d565b9350611617565b6040516370a0823160e01b81526001600160a01b038a811660048301528d16906370a082319060240160206040518083038186803b1580156115dc57600080fd5b505afa1580156115f0573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906116149190614a1d565b93505b6000806116238e61312a565b91509150611649826040518060600160405280602a8152602001615a29602a9139612af9565b806020015160070b935061165e8e8e8e613369565b60408051808201909152601581527f4661696c656420746f206275726e20746f6b656e2e0000000000000000000000602082015260079190910b94509092506116a8908390612af9565b60008d60070b1380156116ba57508b51155b15611740576040516370a0823160e01b81526001600160a01b038c811660048301528f16906370a08231906024015b60206040518083038186803b15801561170157600080fd5b505afa158015611715573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906117399190614a1d565b94506117bc565b6040516370a0823160e01b81526001600160a01b038c811660048301528f16906370a082319060240160206040518083038186803b15801561178157600080fd5b505afa158015611795573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906117b99190614a1d565b94505b50939c929b50909950975095505050505050565b60008060006117df858561343f565b915060070b9150601660030b8214610dbf5760405162461bcd60e51b815260206004820152601660248201527f546f6b656e20697346726f7a656e206661696c656421000000000000000000006044820152606401610a7b565b611841613cfb565b600080610df084613490565b6040516001600160a01b038381166024830152821660448201526060906000908190309063618dc65e908890636eb1769f60e11b9060640161078c565b600060606000806101676001600160a01b031663618dc65e60e01b87876040516024016118b8929190614979565b60408051601f198184030181529181526020820180516001600160e01b03166001600160e01b03199094169390931790925290516118f69190614a36565b6000604051808303816000865af19150503d8060008114611933576040519150601f19603f3d011682016040523d82523d6000602084013e611938565b606091505b50915091507f4af4780e06fe8cb9df64b0794fa6f01399af979175bb988e35e0e57e594567bc828260405161196e929190614aa7565b60405180910390a18161199257601560405180602001604052806000815250611996565b6016815b60039190910b97909650945050505050565b6060600080306001600160a01b031663618dc65e86636352211e60e01b87604051602401610e3a91815260200190565b60008060008060006040516119ec90613c37565b604051809103906000f080158015611a08573d6000803e3d6000fd5b5090506000611a18898389613313565b9050611a59816040518060400160405280601681526020017f4661696c656420746f20617070726f7665204e46542e00000000000000000000815250612af9565b60405163020604bf60e21b8152600481018890526000906001600160a01b038b169063081812fc9060240160206040518083038186803b158015611a9c57600080fd5b505afa158015611ab0573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611ad49190614a8a565b6040517f4adcaa710000000000000000000000000000000000000000000000000000000081526001600160a01b038c81166004830152602482018b90523060448301528b8116606483015291925090841690634adcaa7190608401600060405180830381600087803b158015611b4957600080fd5b505af1158015611b5d573d6000803e3d6000fd5b50506040517f6352211e000000000000000000000000000000000000000000000000000000008152600481018b9052600092506001600160a01b038d169150636352211e9060240160206040518083038186803b158015611bbd57600080fd5b505afa158015611bd1573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611bf59190614a8a565b60405163020604bf60e21b8152600481018b90529091506000906001600160a01b038d169063081812fc9060240160206040518083038186803b158015611c3b57600080fd5b505afa158015611c4f573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190611c739190614a8a565b929c919b509199509297509195505050505050565b6000806000806000611c9a8787613579565b60070b9050611cc181604051806060016040528060278152602001615aa260279139612af9565b600080611cce898961343f565b915060070b9150611cf78360405180606001604052806029815260200161595e60299139612af9565b809450611d0489896135c8565b60070b9250611d48836040518060400160405280601b81526020017f4661696c656420746f20756e667265657a65206163636f756e742e0000000000815250612af9565b611d52898961343f565b8160070b91508092508193505050611d82836040518060600160405280602b81526020016159fe602b9139612af9565b93989397509295505050505050565b6040805160048082526024820183526020820180516001600160e01b03167f18160ddd0000000000000000000000000000000000000000000000000000000017905291516330c6e32f60e11b81526060926000928392309263618dc65e92611dfb92899201614979565b600060405180830381600087803b158015611e1557600080fd5b505af1158015611e29573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052611e5191908101906149e0565b909250905060168214610e025760405162461bcd60e51b815260206004820152601560248201527f546f6b656e207265646972656374206661696c656400000000000000000000006044820152606401610a7b565b611eae613d1b565b600080610ed68585613617565b6040516001600160a01b0383166024820152604481018290526060906000908190309063618dc65e9088907f095ea7b3000000000000000000000000000000000000000000000000000000009060640161078c565b6040805160048082526024820183526020820180516001600160e01b03167f06fdde030000000000000000000000000000000000000000000000000000000017905291516330c6e32f60e11b81526060926000928392309263618dc65e92610f5292899201614979565b6040516001600160a01b0385811660248301528481166044830152831660648201526084810182905260009081908190610167907f9b23d3d9000000000000000000000000000000000000000000000000000000009060a401610ca2565b6040805160018082528183019092526000918291829160208083019080368337019050509050600080898360008151811061201557612015614ac2565b60200260200101906001600160a01b031690816001600160a01b0316815250506000612041898c61370a565b9050612082816040518060400160405280601b81526020017f4661696c656420746f206173736f636961746520746f6b656e732e0000000000815250612af9565b600088118015612090575086155b156120a8576120a18b8b8b8b612fcc565b92506120b7565b6120b48b8b8b8a613759565b92505b6000881180156120c5575086155b156120ff576120d68b8a8c8b612fcc565b90506120fa8160405180606001604052806022815260200161598760229139612af9565b61214c565b61210b8b8a8c8a613759565b905061214c816040518060400160405280601d81526020017f4661696c656420746f207472616e73666572204e465420746f6b656e2e000000815250612af9565b612156898c6137ba565b9050612197816040518060400160405280601b81526020017f4661696c656420746f20646973736f636961746520746f6b656e2e0000000000815250612af9565b6000881180156121a5575086155b156121bd576121b68b8b8b8b612fcc565b91506121cc565b6121c98b8b8b8a613759565b91505b5090999098509650505050505050565b6040805160048082526024820183526020820180516001600160e01b03167f95d89b410000000000000000000000000000000000000000000000000000000017905291516330c6e32f60e11b81526060926000928392309263618dc65e92610f5292899201614979565b6040516001600160a01b038381166024830152821660448201526060906000908190309063618dc65e9088907fe985e9c5000000000000000000000000000000000000000000000000000000009060640161078c565b60008060006122ab8585612e89565b915060070b9150601660030b8214610dbf5760405162461bcd60e51b815260206004820152601360248201527f546f6b656e2069734b7963206661696c656421000000000000000000000000006044820152606401610a7b565b600080600061231384613809565b915060070b9150601660030b8214610e025760405162461bcd60e51b815260206004820152601c60248201527f546f6b656e206973546f6b656e41646472657373206661696c656421000000006044820152606401610a7b565b60008060008060008060008060008b60070b13801561238b57508951155b15612410576040516370a0823160e01b81526001600160a01b038a811660048301528d16906370a082319060240160206040518083038186803b1580156123d157600080fd5b505afa1580156123e5573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906124099190614a1d565b935061248c565b6040516370a0823160e01b81526001600160a01b038a811660048301528d16906370a082319060240160206040518083038186803b15801561245157600080fd5b505afa158015612465573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906124899190614a1d565b93505b6000806124988e61312a565b915091506124db826040518060400160405280601e81526020017f4661696c656420746f20726574726965766520746f6b656e20696e666f2e0000815250612af9565b806020015160070b93506124f08e8e8e613852565b5060408051808201909152601581527f4661696c656420746f206d696e7420746f6b656e2e0000000000000000000000602082015260079190910b94509092506116a8908390612af9565b600080600080600061254c86613950565b905061258d816040518060400160405280601681526020017f4661696c656420746f20706175736520746f6b656e2e00000000000000000000815250612af9565b6000806125998861312a565b915091506125bf83604051806060016040528060258152602001615a7d60259139612af9565b806080015194506125cf88613a43565b9250612610836040518060400160405280601881526020017f4661696c656420746f20756e706175736520746f6b656e2e0000000000000000815250612af9565b6126198861312a565b8092508193505050612643836040518060600160405280602c81526020016159a9602c9139612af9565b60800151939793965092945050505050565b6040516001600160a01b0383166024820152604481018290526060906000908190309063618dc65e9088907fa9059cbb000000000000000000000000000000000000000000000000000000009060640161078c565b60008060006126b884613a8a565b60030b915060070b9150601660030b8214610e025760405162461bcd60e51b815260206004820152601c60248201527f546f6b656e20747970652061707072616973616c206661696c656421000000006044820152606401610a7b565b60008080808080808060078b900b8112801561273057508951155b156127b5576040516370a0823160e01b81526001600160a01b038a811660048301528d16906370a082319060240160206040518083038186803b15801561277657600080fd5b505afa15801561278a573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906127ae9190614a1d565b9350612831565b6040516370a0823160e01b81526001600160a01b038a811660048301528d16906370a082319060240160206040518083038186803b1580156127f657600080fd5b505afa15801561280a573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061282e9190614a1d565b93505b60008061283d8e61312a565b91509150612863826040518060600160405280602a8152602001615a53602a9139612af9565b806020015160070b935060008d60070b13801561287f57508b51155b156128965761288f8e8c8f613b67565b91506128a4565b6128a18e8c8e613bc0565b91505b6128e3826040518060400160405280601581526020017f4661696c656420746f207769706520746f6b656e2e0000000000000000000000815250612af9565b6128ec8e61312a565b8092508193505050612916826040518060600160405280602981526020016159d560299139612af9565b806020015160070b925060008d60070b1380156116ba57508b51611740576040516370a0823160e01b81526001600160a01b038c811660048301528f16906370a08231906024016116e9565b6060600080306001600160a01b031663618dc65e8663c87b56dd60e01b87604051602401610e3a91815260200190565b60008060006129a084613bee565b909250905060168214610e025760405162461bcd60e51b815260206004820181905260248201527f676574546f6b656e44656661756c744b7963537461747573206661696c6564216044820152606401610a7b565b6040516001600160a01b038481166024830152831660448201526064810182905260009081908190610167907fe1f21c6700000000000000000000000000000000000000000000000000000000906084015b60408051601f198184030181529181526020820180516001600160e01b03166001600160e01b0319909416939093179092529051612a859190614a36565b6000604051808303816000865af19150503d8060008114612ac2576040519150601f19603f3d011682016040523d82523d6000602084013e612ac7565b606091505b509150915081612ad8576015612aec565b80806020019051810190612aec9190614a64565b60030b9695505050505050565b60168214612b1b578060405162461bcd60e51b8152600401610a7b9190613e33565b5050565b6040805160a081018252600080825260208083018290526060838501819052808401526080830182905283516001600160a01b03871660248201526044808201879052855180830390910181526064909101855290810180516001600160e01b03167f3c4dd32e00000000000000000000000000000000000000000000000000000000179052925190928391829161016791612bbb9190614a36565b6000604051808303816000865af19150503d8060008114612bf8576040519150601f19603f3d011682016040523d82523d6000602084013e612bfd565b606091505b5091509150612c486040518060a0016040528060001515815260200160006001600160a01b03168152602001606081526020016060815260200160006001600160a01b031681525090565b82612c5557601581612c69565b81806020019051810190612c699190614b8b565b60039190910b9890975095505050505050565b604080516060810182526000808252602080830182905282840182905283516001600160a01b038616602480830191909152855180830390910181526044909101855290810180516001600160e01b03167fd614cdb800000000000000000000000000000000000000000000000000000000179052925190928391829161016791612d079190614a36565b6000604051808303816000865af19150503d8060008114612d44576040519150601f19603f3d011682016040523d82523d6000602084013e612d49565b606091505b506040805160608101825260008082526020820181905291810191909152919350915082612d7957601581611996565b818060200190518101906119969190614c52565b6040516001600160a01b0383811660248301528216604482015260009081908190610167907f8f8d7f9900000000000000000000000000000000000000000000000000000000906064015b60408051601f198184030181529181526020820180516001600160e01b03166001600160e01b0319909416939093179092529051612e169190614a36565b6000604051808303816000865af19150503d8060008114612e53576040519150601f19603f3d011682016040523d82523d6000602084013e612e58565b606091505b509150915081612e69576015612e7d565b80806020019051810190612e7d9190614a64565b60030b95945050505050565b6040516001600160a01b03838116602483015282166044820152600090819081908190610167907ff2c31ff400000000000000000000000000000000000000000000000000000000906064015b60408051601f198184030181529181526020820180516001600160e01b03166001600160e01b0319909416939093179092529051612f149190614a36565b6000604051808303816000865af19150503d8060008114612f51576040519150601f19603f3d011682016040523d82523d6000602084013e612f56565b606091505b509150915081612f695760156000611996565b808060200190518101906119969190614c86565b6040516001600160a01b0383811660248301528216604482015260009081908190610167907faf99c6330000000000000000000000000000000000000000000000000000000090606401612dd8565b6040516001600160a01b038581166024830152848116604483015283166064820152600782900b608482015260009081908190610167907feca36917000000000000000000000000000000000000000000000000000000009060a401610ca2565b6040516001600160a01b0382166024820152600090819081908190610167907fa7daa18d00000000000000000000000000000000000000000000000000000000906044015b60408051601f198184030181529181526020820180516001600160e01b03166001600160e01b03199094169390931790925290516130b09190614a36565b6000604051808303816000865af19150503d80600081146130ed576040519150601f19603f3d011682016040523d82523d6000602084013e6130f2565b606091505b5091509150816131055760156000613119565b808060200190518101906131199190614c86565b60039190910b969095509350505050565b6000613134613c44565b604080516001600160a01b03851660248083019190915282518083039091018152604490910182526020810180516001600160e01b03167f1f69565f0000000000000000000000000000000000000000000000000000000017905290516000918291610167916131a391614a36565b6000604051808303816000865af19150503d80600081146131e0576040519150601f19603f3d011682016040523d82523d6000602084013e6131e5565b606091505b50915091506131f2613c44565b826131ff57601581611996565b818060200190518101906119969190615240565b604080516001600160a01b03831660248083019190915282518083039091018152604490910182526020810180516001600160e01b03167fae7611a000000000000000000000000000000000000000000000000000000000179052905160009160609182918291859182916101679161328b91614a36565b6000604051808303816000865af19150503d80600081146132c8576040519150601f19603f3d011682016040523d82523d6000602084013e6132cd565b606091505b50915091506060806060846132e65760158383836132fa565b838060200190518101906132fa9190615284565b60039390930b9d919c509a509098509650505050505050565b6040516001600160a01b038481166024830152831660448201526064810182905260009081908190610167907f7336aaf00000000000000000000000000000000000000000000000000000000090608401612a47565b6000806000806101676001600160a01b031663d6910d0660e01b88888860405160240161339893929190615350565b60408051601f198184030181529181526020820180516001600160e01b03166001600160e01b03199094169390931790925290516133d69190614a36565b6000604051808303816000865af19150503d8060008114613413576040519150601f19603f3d011682016040523d82523d6000602084013e613418565b606091505b50915091508161342b5760156000612c69565b80806020019051810190612c69919061537b565b6040516001600160a01b03838116602483015282166044820152600090819081908190610167907f46de0fb10000000000000000000000000000000000000000000000000000000090606401612ed6565b600061349a613cfb565b604080516001600160a01b03851660248083019190915282518083039091018152604490910182526020810180516001600160e01b03167f3f28a19b00000000000000000000000000000000000000000000000000000000179052905160009182916101679161350991614a36565b6000604051808303816000865af19150503d8060008114613546576040519150601f19603f3d011682016040523d82523d6000602084013e61354b565b606091505b5091509150613558613cfb565b8261356557601581611996565b8180602001905181019061199691906153a7565b6040516001600160a01b0383811660248301528216604482015260009081908190610167907f5b8f85840000000000000000000000000000000000000000000000000000000090606401612dd8565b6040516001600160a01b0383811660248301528216604482015260009081908190610167907f52f913870000000000000000000000000000000000000000000000000000000090606401612dd8565b6000613621613d1b565b604080516001600160a01b0386166024820152600785900b60448083019190915282518083039091018152606490910182526020810180516001600160e01b03167f287e1da800000000000000000000000000000000000000000000000000000000179052905160009182916101679161369a91614a36565b6000604051808303816000865af19150503d80600081146136d7576040519150601f19603f3d011682016040523d82523d6000602084013e6136dc565b606091505b50915091506136e9613d1b565b826136f657601581612c69565b81806020019051810190612c69919061544e565b6040516001600160a01b0383811660248301528216604482015260009081908190610167907f49146bde0000000000000000000000000000000000000000000000000000000090606401612dd8565b6040516001600160a01b038581166024830152848116604483015283166064820152600782900b608482015260009081908190610167907f5cfc9011000000000000000000000000000000000000000000000000000000009060a401610ca2565b6040516001600160a01b0383811660248301528216604482015260009081908190610167907f099794e80000000000000000000000000000000000000000000000000000000090606401612dd8565b6040516001600160a01b0382166024820152600090819081908190610167907f19f373610000000000000000000000000000000000000000000000000000000090604401613072565b60008060606000806101676001600160a01b031663e0f4059a60e01b89898960405160240161388393929190615536565b60408051601f198184030181529181526020820180516001600160e01b03166001600160e01b03199094169390931790925290516138c19190614a36565b6000604051808303816000865af19150503d80600081146138fe576040519150601f19603f3d011682016040523d82523d6000602084013e613903565b606091505b50915091508161392657604080516000808252602082019092526015919061393a565b8080602001905181019061393a91906155b3565b60039290920b9a90995090975095505050505050565b6040516001600160a01b038216602482015260009081908190610167907f7c41ad2c00000000000000000000000000000000000000000000000000000000906044015b60408051601f198184030181529181526020820180516001600160e01b03166001600160e01b03199094169390931790925290516139d19190614a36565b6000604051808303816000865af19150503d8060008114613a0e576040519150601f19603f3d011682016040523d82523d6000602084013e613a13565b606091505b509150915081613a24576015613a38565b80806020019051810190613a389190614a64565b60030b949350505050565b6040516001600160a01b038216602482015260009081908190610167907f3b3bff0f0000000000000000000000000000000000000000000000000000000090604401613993565b604080516001600160a01b03831660248083019190915282518083039091018152604490910182526020810180516001600160e01b03167f93272baf00000000000000000000000000000000000000000000000000000000179052905160009182918291829161016791613afd91614a36565b6000604051808303816000865af19150503d8060008114613b3a576040519150601f19603f3d011682016040523d82523d6000602084013e613b3f565b606091505b509150915081613b53576015600019613119565b808060200190518101906131199190615673565b6040516001600160a01b03848116602483015283166044820152600782900b606482015260009081908190610167907fefef57f90000000000000000000000000000000000000000000000000000000090608401612a47565b60008060006101676001600160a01b031663f7f38e2660e01b878787604051602401612a479392919061569d565b6040516001600160a01b0382166024820152600090819081908190610167907f335e04c10000000000000000000000000000000000000000000000000000000090604401613072565b610273806156ca83390190565b60408051610240810182526060610120820181815261014083018290526000610160840181905261018084018390526101a084018190526101c084018190526101e0840181905261020084018390528451928301855280835260208301819052938201939093526102208201529081908152602001600060070b8152602001600015158152602001600015158152602001600015158152602001606081526020016060815260200160608152602001606081525090565b6040518060400160405280613d0e613c44565b8152600060209091015290565b6040518060c00160405280613d2e613c44565b8152600060208201819052604082018190526060808301829052608083015260a09091015290565b6001600160a01b0381168114613d6b57600080fd5b50565b8035613d7981613d56565b919050565b8015158114613d6b57600080fd5b600080600060608486031215613da157600080fd5b8335613dac81613d56565b92506020840135613dbc81613d56565b91506040840135613dcc81613d7e565b809150509250925092565b60005b83811015613df2578181015183820152602001613dda565b83811115613e01576000848401525b50505050565b60008151808452613e1f816020860160208601613dd7565b601f01601f19169290920160200192915050565b602081526000610e026020830184613e07565b600080600060608486031215613e5b57600080fd5b8335613e6681613d56565b92506020840135613e7681613d56565b929592945050506040919091013590565b60008060008060808587031215613e9d57600080fd5b8435613ea881613d56565b93506020850135613eb881613d56565b92506040850135613ec881613d56565b9396929550929360600135925050565b60008060408385031215613eeb57600080fd5b8235613ef681613d56565b946020939093013593505050565b805115158252600060208201516001600160a01b0380821660208601526040840151915060a06040860152613f3c60a0860183613e07565b915060608401518583036060870152613f558382613e07565b925050806080850151166080860152508091505092915050565b602081526000610e026020830184613f04565b600060208284031215613f9457600080fd5b8135610e0281613d56565b60608101610dc38284805160070b82526001600160a01b036020820151166020830152604081015160070b60408301525050565b60008060408385031215613fe657600080fd5b8235613ff181613d56565b9150602083013561400181613d56565b809150509250929050565b600081518084526020808501808196508360051b8101915082860160005b85811015614068578284038952815180518552850151604086860181905261405481870183613f04565b9a87019a955050509084019060010161402a565b5091979650505050505050565b6000610160825181855261408b82860182613e07565b915050602083015184820360208601526140a58282613e07565b91505060408301516140c260408601826001600160a01b03169052565b50606083015184820360608601526140da8282613e07565b91505060808301516140f0608086018215159052565b5060a083015161410560a086018260070b9052565b5060c083015161411960c086018215159052565b5060e083015184820360e0860152614131828261400c565b9150506101008084015161416d82870182805160070b82526001600160a01b036020820151166020830152604081015160070b60408301525050565b5090949350505050565b600081518084526020808501945080840160005b838110156141e4578151805160070b8852838101516001600160a01b03908116858a01526040808301511515908a01526060808301511515908a0152608091820151169088015260a0909601959082019060010161418b565b509495945050505050565b600081518084526020808501945080840160005b838110156141e45781518051600790810b895284820151810b858a0152604080830151820b908a015260608083015190910b9089015260808082015115159089015260a0908101516001600160a01b03169088015260c09096019590820190600101614203565b600081518084526020808501945080840160005b838110156141e45781518051600790810b895284820151810b858a015260408083015190910b908901526060808201516001600160a01b03908116918a01919091526080808301511515908a015260a091820151169088015260c0909601959082019060010161427e565b600061012082518185526142ff82860182614075565b9150506020830151614316602086018260070b9052565b50604083015161432a604086018215159052565b50606083015161433e606086018215159052565b506080830151614352608086018215159052565b5060a083015184820360a086015261436a8282614177565b91505060c083015184820360c086015261438482826141ef565b91505060e083015184820360e086015261439e828261426a565b91505061010080840151858303828701526113048382613e07565b602081526000610e0260208301846142e9565b6060815260006143df6060830186614177565b82810360208401526143f181866141ef565b90508281036040840152611304818561426a565b6000806000806080858703121561441b57600080fd5b843561442681613d56565b9350602085013561443681613d56565b93969395505050506040820135916060013590565b8060070b8114613d6b57600080fd5b634e487b7160e01b600052604160045260246000fd5b60405160a0810167ffffffffffffffff811182821017156144935761449361445a565b60405290565b6040805190810167ffffffffffffffff811182821017156144935761449361445a565b604051610120810167ffffffffffffffff811182821017156144935761449361445a565b60405160c0810167ffffffffffffffff811182821017156144935761449361445a565b604051601f8201601f1916810167ffffffffffffffff8111828210171561452c5761452c61445a565b604052919050565b600067ffffffffffffffff82111561454e5761454e61445a565b5060051b60200190565b6000806000806080858703121561456e57600080fd5b843561457981613d56565b935060208581013561458a8161444b565b9350604086013567ffffffffffffffff8111156145a657600080fd5b8601601f810188136145b757600080fd5b80356145ca6145c582614534565b614503565b81815260059190911b8201830190838101908a8311156145e957600080fd5b928401925b828410156146105783356146018161444b565b825292840192908401906145ee565b809650505050505061462460608601613d6e565b905092959194509250565b60208152600082516040602084015261464b60608401826142e9565b9050602084015160030b60408401528091505092915050565b60008060006060848603121561467957600080fd5b833561468481613d56565b9250602084013561469481613d56565b91506040840135613dcc81613d56565b600067ffffffffffffffff8211156146be576146be61445a565b50601f01601f191660200190565b600082601f8301126146dd57600080fd5b81356146eb6145c5826146a4565b81815284602083860101111561470057600080fd5b816020850160208301376000918101602001919091529392505050565b6000806040838503121561473057600080fd5b823561473b81613d56565b9150602083013567ffffffffffffffff81111561475757600080fd5b614763858286016146cc565b9150509250929050565b8281526040602082015260006147866040830184613e07565b949350505050565b600080604083850312156147a157600080fd5b82356147ac81613d56565b915060208301356140018161444b565b602081526000825160c060208401526147d860e08401826142e9565b9050602084015160070b604084015260408401516001600160a01b038082166060860152606086015160070b608086015260808601519150601f198584030160a08601526148268383613e07565b92508060a08701511660c086015250508091505092915050565b600080600080600060a0868803121561485857600080fd5b853561486381613d56565b9450602086013561487381613d56565b9350604086013561488381613d56565b94979396509394606081013594506080013592915050565b600080600080608085870312156148b157600080fd5b84356148bc81613d56565b93506020858101356148cd8161444b565b9350604086013567ffffffffffffffff808211156148ea57600080fd5b818801915088601f8301126148fe57600080fd5b813561490c6145c582614534565b81815260059190911b8301840190848101908b83111561492b57600080fd5b8585015b83811015614963578035858111156149475760008081fd5b6149558e89838a01016146cc565b84525091860191860161492f565b5080975050505050505061462460608601613d6e565b6001600160a01b03831681526040602082015260006147866040830184613e07565b600082601f8301126149ac57600080fd5b81516149ba6145c5826146a4565b8181528460208386010111156149cf57600080fd5b610dbf826020830160208701613dd7565b600080604083850312156149f357600080fd5b82519150602083015167ffffffffffffffff811115614a1157600080fd5b6147638582860161499b565b600060208284031215614a2f57600080fd5b5051919050565b60008251614a48818460208701613dd7565b9190910192915050565b8051600381900b8114613d7957600080fd5b600060208284031215614a7657600080fd5b610e0282614a52565b8051613d7981613d56565b600060208284031215614a9c57600080fd5b8151610e0281613d56565b82151581526040602082015260006147866040830184613e07565b634e487b7160e01b600052603260045260246000fd5b8051613d7981613d7e565b600060a08284031215614af557600080fd5b614afd614470565b90508151614b0a81613d7e565b81526020820151614b1a81613d56565b6020820152604082015167ffffffffffffffff80821115614b3a57600080fd5b614b468583860161499b565b60408401526060840151915080821115614b5f57600080fd5b50614b6c8482850161499b565b6060830152506080820151614b8081613d56565b608082015292915050565b60008060408385031215614b9e57600080fd5b614ba783614a52565b9150602083015167ffffffffffffffff811115614bc357600080fd5b61476385828601614ae3565b8051613d798161444b565b600060608284031215614bec57600080fd5b6040516060810181811067ffffffffffffffff82111715614c0f57614c0f61445a565b80604052508091508251614c228161444b565b81526020830151614c3281613d56565b60208201526040830151614c458161444b565b6040919091015292915050565b60008060808385031215614c6557600080fd5b614c6e83614a52565b9150614c7d8460208501614bda565b90509250929050565b60008060408385031215614c9957600080fd5b614ca283614a52565b9150602083015161400181613d7e565b600082601f830112614cc357600080fd5b81516020614cd36145c583614534565b82815260059290921b84018101918181019086841115614cf257600080fd5b8286015b84811015614d7457805167ffffffffffffffff80821115614d175760008081fd5b908801906040828b03601f1901811315614d315760008081fd5b614d39614499565b838801518152908301519082821115614d525760008081fd5b614d608c8984870101614ae3565b818901528652505050918301918301614cf6565b509695505050505050565b60006101608284031215614d9257600080fd5b614d9a6144bc565b9050815167ffffffffffffffff80821115614db457600080fd5b614dc08583860161499b565b83526020840151915080821115614dd657600080fd5b614de28583860161499b565b6020840152614df360408501614a7f565b60408401526060840151915080821115614e0c57600080fd5b614e188583860161499b565b6060840152614e2960808501614ad8565b6080840152614e3a60a08501614bcf565b60a0840152614e4b60c08501614ad8565b60c084015260e0840151915080821115614e6457600080fd5b50614e7184828501614cb2565b60e083015250610100614e8684828501614bda565b9082015292915050565b600082601f830112614ea157600080fd5b81516020614eb16145c583614534565b82815260a09283028501820192828201919087851115614ed057600080fd5b8387015b85811015614f585781818a031215614eec5760008081fd5b614ef4614470565b8151614eff8161444b565b815281860151614f0e81613d56565b81870152604082810151614f2181613d7e565b90820152606082810151614f3481613d7e565b90820152608082810151614f4781613d56565b908201528452928401928101614ed4565b5090979650505050505050565b600082601f830112614f7657600080fd5b81516020614f866145c583614534565b82815260c09283028501820192828201919087851115614fa557600080fd5b8387015b85811015614f585781818a031215614fc15760008081fd5b614fc96144e0565b8151614fd48161444b565b815281860151614fe38161444b565b81870152604082810151614ff68161444b565b908201526060828101516150098161444b565b9082015260808281015161501c81613d7e565b9082015260a08281015161502f81613d56565b908201528452928401928101614fa9565b600082601f83011261505157600080fd5b815160206150616145c583614534565b82815260c0928302850182019282820191908785111561508057600080fd5b8387015b85811015614f585781818a03121561509c5760008081fd5b6150a46144e0565b81516150af8161444b565b8152818601516150be8161444b565b818701526040828101516150d18161444b565b908201526060828101516150e481613d56565b908201526080828101516150f781613d7e565b9082015260a08281015161510a81613d56565b908201528452928401928101615084565b6000610120828403121561512e57600080fd5b6151366144bc565b9050815167ffffffffffffffff8082111561515057600080fd5b61515c85838601614d7f565b835261516a60208501614bcf565b602084015261517b60408501614ad8565b604084015261518c60608501614ad8565b606084015261519d60808501614ad8565b608084015260a08401519150808211156151b657600080fd5b6151c285838601614e90565b60a084015260c08401519150808211156151db57600080fd5b6151e785838601614f65565b60c084015260e084015191508082111561520057600080fd5b61520c85838601615040565b60e08401526101009150818401518181111561522757600080fd5b6152338682870161499b565b8385015250505092915050565b6000806040838503121561525357600080fd5b61525c83614a52565b9150602083015167ffffffffffffffff81111561527857600080fd5b6147638582860161511b565b6000806000806080858703121561529a57600080fd5b6152a385614a52565b9350602085015167ffffffffffffffff808211156152c057600080fd5b6152cc88838901614e90565b945060408701519150808211156152e257600080fd5b6152ee88838901614f65565b9350606087015191508082111561530457600080fd5b5061531187828801615040565b91505092959194509250565b600081518084526020808501945080840160005b838110156141e457815160070b87529582019590820190600101615331565b6001600160a01b03841681528260070b602082015260606040820152600061083a606083018461531d565b6000806040838503121561538e57600080fd5b61539783614a52565b915060208301516140018161444b565b600080604083850312156153ba57600080fd5b6153c383614a52565b9150602083015167ffffffffffffffff808211156153e057600080fd5b90840190604082870312156153f457600080fd5b60405160408101818110838211171561540f5761540f61445a565b60405282518281111561542157600080fd5b61542d8882860161511b565b82525061543c60208401614a52565b60208201528093505050509250929050565b6000806040838503121561546157600080fd5b61546a83614a52565b9150602083015167ffffffffffffffff8082111561548757600080fd5b9084019060c0828703121561549b57600080fd5b6154a36144e0565b8251828111156154b257600080fd5b6154be8882860161511b565b8252506154cd60208401614bcf565b60208201526154de60408401614a7f565b60408201526154ef60608401614bcf565b606082015260808301518281111561550657600080fd5b6155128882860161499b565b60808301525061552460a08401614a7f565b60a08201528093505050509250929050565b6000606082016001600160a01b038616835260208560070b818501526060604085015281855180845260808601915060808160051b870101935082870160005b828110156155a457607f19888703018452615592868351613e07565b95509284019290840190600101615576565b50939998505050505050505050565b6000806000606084860312156155c857600080fd5b6155d184614a52565b92506020808501516155e28161444b565b604086015190935067ffffffffffffffff8111156155ff57600080fd5b8501601f8101871361561057600080fd5b805161561e6145c582614534565b81815260059190911b8201830190838101908983111561563d57600080fd5b928401925b828410156156645783516156558161444b565b82529284019290840190615642565b80955050505050509250925092565b6000806040838503121561568657600080fd5b61568f83614a52565b9150614c7d60208401614a52565b60006001600160a01b0380861683528085166020840152506060604083015261083a606083018461531d56fe608060405234801561001057600080fd5b50610253806100206000396000f3fe608060405234801561001057600080fd5b50600436106100365760003560e01c80634444fbf71461003b5780634adcaa7114610050575b600080fd5b61004e6100493660046101a7565b610063565b005b61004e61005e3660046101a7565b610101565b6040516323b872dd60e01b815273ffffffffffffffffffffffffffffffffffffffff83811660048301528281166024830152604482018590528516906323b872dd90606401602060405180830381600087803b1580156100c257600080fd5b505af11580156100d6573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906100fa91906101f4565b5050505050565b6040516323b872dd60e01b815273ffffffffffffffffffffffffffffffffffffffff83811660048301528281166024830152604482018590528516906323b872dd90606401600060405180830381600087803b15801561016057600080fd5b505af1158015610174573d6000803e3d6000fd5b5050505050505050565b803573ffffffffffffffffffffffffffffffffffffffff811681146101a257600080fd5b919050565b600080600080608085870312156101bd57600080fd5b6101c68561017e565b9350602085013592506101db6040860161017e565b91506101e96060860161017e565b905092959194509250565b60006020828403121561020657600080fd5b8151801515811461021657600080fd5b939250505056fea264697066735822122091d398dc169b28c2d55ecdecc74ea7172cedaddff0baf70b56130cfc59c466e564736f6c634300080900334661696c656420746f20617070726f76652046756e6769626c6520746f6b656e2e4661696c656420746f20636865636b20667265657a6520737461747573206f66206163636f756e742e4661696c656420746f207472616e736665722046756e6769626c6520746f6b656e2e4661696c656420746f20726574726965766520746f6b656e20696e666f20616674657220756e70617573652e4661696c656420746f20726574726965766520746f6b656e20696e666f20616674657220776970652e4661696c656420746f20636865636b20756e667265657a6520737461747573206f66206163636f756e742e4661696c656420746f20726574726965766520746f6b656e20696e666f206265666f7265206275726e2e4661696c656420746f20726574726965766520746f6b656e20696e666f206265666f726520776970652e4661696c656420746f2067657420746f6b656e20696e666f2061667465722070617573652e4661696c656420746f20667265657a6520746f6b656e20666f7220746865206163636f756e742ea2646970667358221220116b7f0106e83cbe3864338cd8a0dff96e820141d0acb2f432fa3f69240edc7d64736f6c63430008090033";
      const fileResponse = await JSONRPCRequest(this, "createFile", {
        keys: [fileCreateEd25519PublicKey],
        contents: systemContractBytecode.substring(0, 5800),
        commonTransactionParams: {
          signers: [fileCreateEd25519PrivateKey],
        },
      });
      const fileId = fileResponse.fileId;

      const appendResponse = await JSONRPCRequest(this, "appendFile", {
        keys: [fileCreateEd25519PublicKey],
        fileId,
        contents: systemContractBytecode.substring(5800),
        commonTransactionParams: {
          signers: [fileCreateEd25519PrivateKey],
        },
      });
      expect(appendResponse.status).to.equal("SUCCESS");

      const response = await JSONRPCRequest(this, "createContract", {
        bytecodeFileId: fileId,
        gas: "5500000",
        commonTransactionParams: {
          signers: [fileCreateEd25519PrivateKey],
        },
      });
      expect(response.status).to.equal("SUCCESS");

      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.contractId.toString()).to.equal(response.contractId);
    });

    it("(#9) Create and deploy a valid contract that uses the the Hiero schedule service system contract", async function () {
      const fileCreateEd25519PrivateKey = await generateEd25519PrivateKey(this);
      const fileCreateEd25519PublicKey = await generateEd25519PublicKey(
        this,
        fileCreateEd25519PrivateKey,
      );
      const systemContractBytecode =
        "6080604052348015600e575f5ffd5b506108408061001c5f395ff3fe608060405234801561000f575f5ffd5b5060043610610034575f3560e01c8063092a105214610038578063fb53b55614610068575b5f5ffd5b610052600480360381019061004d91906103da565b610098565b60405161005f9190610420565b60405180910390f35b610082600480360381019061007d9190610575565b6100f2565b60405161008f9190610420565b60405180910390f35b5f6100a28261014e565b9050601660030b8160070b146100ed576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016100e490610629565b60405180910390fd5b919050565b5f6100fd838361025d565b9050601660030b8160070b14610148576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161013f90610691565b60405180910390fd5b92915050565b5f5f5f61016b73ffffffffffffffffffffffffffffffffffffffff1663f063796160e01b8560405160240161018391906106be565b604051602081830303815290604052907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506040516101ed9190610729565b5f604051808303815f865af19150503d805f8114610226576040519150601f19603f3d011682016040523d82523d5f602084013e61022b565b606091505b50915091508161023f57601560030b610254565b808060200190518101906102539190610769565b5b92505050919050565b5f5f5f61016b73ffffffffffffffffffffffffffffffffffffffff1663358eeb0360e01b86866040516024016102949291906107dc565b604051602081830303815290604052907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050506040516102fe9190610729565b5f604051808303815f865af19150503d805f8114610337576040519150601f19603f3d011682016040523d82523d5f602084013e61033c565b606091505b50915091508161035057601560030b610365565b808060200190518101906103649190610769565b5b9250505092915050565b5f604051905090565b5f5ffd5b5f5ffd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6103a982610380565b9050919050565b6103b98161039f565b81146103c3575f5ffd5b50565b5f813590506103d4816103b0565b92915050565b5f602082840312156103ef576103ee610378565b5b5f6103fc848285016103c6565b91505092915050565b5f8160070b9050919050565b61041a81610405565b82525050565b5f6020820190506104335f830184610411565b92915050565b5f5ffd5b5f5ffd5b5f601f19601f8301169050919050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b61048782610441565b810181811067ffffffffffffffff821117156104a6576104a5610451565b5b80604052505050565b5f6104b861036f565b90506104c4828261047e565b919050565b5f67ffffffffffffffff8211156104e3576104e2610451565b5b6104ec82610441565b9050602081019050919050565b828183375f83830152505050565b5f610519610514846104c9565b6104af565b9050828152602081018484840111156105355761053461043d565b5b6105408482856104f9565b509392505050565b5f82601f83011261055c5761055b610439565b5b813561056c848260208601610507565b91505092915050565b5f5f6040838503121561058b5761058a610378565b5b5f610598858286016103c6565b925050602083013567ffffffffffffffff8111156105b9576105b861037c565b5b6105c585828601610548565b9150509250929050565b5f82825260208201905092915050565b7f417574686f72697a65207363686564756c65206661696c65642e0000000000005f82015250565b5f610613601a836105cf565b915061061e826105df565b602082019050919050565b5f6020820190508181035f83015261064081610607565b9050919050565b7f5369676e207363686564756c65206661696c65642e00000000000000000000005f82015250565b5f61067b6015836105cf565b915061068682610647565b602082019050919050565b5f6020820190508181035f8301526106a88161066f565b9050919050565b6106b88161039f565b82525050565b5f6020820190506106d15f8301846106af565b92915050565b5f81519050919050565b5f81905092915050565b8281835e5f83830152505050565b5f610703826106d7565b61070d81856106e1565b935061071d8185602086016106eb565b80840191505092915050565b5f61073482846106f9565b915081905092915050565b61074881610405565b8114610752575f5ffd5b50565b5f815190506107638161073f565b92915050565b5f6020828403121561077e5761077d610378565b5b5f61078b84828501610755565b91505092915050565b5f82825260208201905092915050565b5f6107ae826106d7565b6107b88185610794565b93506107c88185602086016106eb565b6107d181610441565b840191505092915050565b5f6040820190506107ef5f8301856106af565b818103602083015261080181846107a4565b9050939250505056fea2646970667358221220ac0563d807035930d46f46ff24d1c6cf4480367f85bb638710d225c9285bb36a64736f6c634300081e0033";
      const fileResponse = await JSONRPCRequest(this, "createFile", {
        keys: [fileCreateEd25519PublicKey],
        contents: systemContractBytecode,
        commonTransactionParams: {
          signers: [fileCreateEd25519PrivateKey],
        },
      });
      const fileId = fileResponse.fileId;

      const response = await JSONRPCRequest(this, "createContract", {
        bytecodeFileId: fileId,
        gas: "1000000",
        commonTransactionParams: {
          signers: [fileCreateEd25519PrivateKey],
        },
      });
      expect(response.status).to.equal("SUCCESS");

      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.contractId.toString()).to.equal(response.contractId);
    });

    it("(#10) Create and deploy a valid contract that uses the the Hiero exchange rate system contract", async function () {
      const fileCreateEd25519PrivateKey = await generateEd25519PrivateKey(this);
      const fileCreateEd25519PublicKey = await generateEd25519PublicKey(
        this,
        fileCreateEd25519PrivateKey,
      );
      const systemContractBytecode =
        "608060405234801561000f575f80fd5b506102c88061001d5f395ff3fe608060405234801561000f575f80fd5b5060043610610034575f3560e01c80634abd27a314610038578063677feb671461005d575b5f80fd5b61004b610046366004610238565b610070565b60405190815260200160405180910390f35b61004b61006b366004610238565b6100ba565b5f61007a826100f7565b90507f1e2eedf37f019c356cd1ab2a7445bef30fa8b9e32be6636e6efae70244c7b3e0816040516100ad91815260200190565b60405180910390a1919050565b5f6100c482610201565b90507fc399bb30ec076dee6179663a550714898c27a4a8cf23a336b2e49ec777779459816040516100ad91815260200190565b5f805f61016873ffffffffffffffffffffffffffffffffffffffff16632e3cff6a60e01b8560405160240161012e91815260200190565b60408051601f198184030181529181526020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff167fffffffff00000000000000000000000000000000000000000000000000000000909416939093179092529051610199919061024f565b5f604051808303815f865af19150503d805f81146101d2576040519150601f19603f3d011682016040523d82523d5f602084013e6101d7565b606091505b5091509150816101e5575f80fd5b808060200190518101906101f9919061027b565b949350505050565b5f805f61016873ffffffffffffffffffffffffffffffffffffffff166343a8822960e01b8560405160240161012e91815260200190565b5f60208284031215610248575f80fd5b5035919050565b5f82515f5b8181101561026e5760208186018101518583015201610254565b505f920191825250919050565b5f6020828403121561028b575f80fd5b505191905056fea264697066735822122020c2f9bdbf9c77533dcf0e817f4538cd46ba5a1d761e8d01cc311ca4cd2cc7f864736f6c63430008180033";
      const fileResponse = await JSONRPCRequest(this, "createFile", {
        keys: [fileCreateEd25519PublicKey],
        contents: systemContractBytecode,
        commonTransactionParams: {
          signers: [fileCreateEd25519PrivateKey],
        },
      });
      const fileId = fileResponse.fileId;

      const response = await JSONRPCRequest(this, "createContract", {
        bytecodeFileId: fileId,
        gas: "300000",
        commonTransactionParams: {
          signers: [fileCreateEd25519PrivateKey],
        },
      });
      expect(response.status).to.equal("SUCCESS");

      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.contractId.toString()).to.equal(response.contractId);
    });

    it("(#11) Create and deploy a valid contract that uses the the Hiero psuedo random number generator system contract", async function () {
      const fileCreateEd25519PrivateKey = await generateEd25519PrivateKey(this);
      const fileCreateEd25519PublicKey = await generateEd25519PublicKey(
        this,
        fileCreateEd25519PrivateKey,
      );
      const systemContractBytecode =
        "608060405234801561000f575f80fd5b506101fb8061001d5f395ff3fe608060405234801561000f575f80fd5b5060043610610029575f3560e01c8063d83bf9a11461002d575b5f80fd5b610035610047565b60405190815260200160405180910390f35b60408051600481526024810182526020810180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1663d83bf9a160e01b17905290515f91829182916101699161009a9190610182565b5f604051808303815f865af19150503d805f81146100d3576040519150601f19603f3d011682016040523d82523d5f602084013e6100d8565b606091505b50915091508161012e5760405162461bcd60e51b815260206004820152601760248201527f50524e472073797374656d2063616c6c206661696c6564000000000000000000604482015260640160405180910390fd5b8080602001905181019061014291906101ae565b92507f597d607a3790e8d60862649d1fef7e222a0160226d4648901d47e03c6f056f668360405161017591815260200190565b60405180910390a1505090565b5f82515f5b818110156101a15760208186018101518583015201610187565b505f920191825250919050565b5f602082840312156101be575f80fd5b505191905056fea26469706673582212206f5ba247eaa26eaa11adb607ec6111bfd220b8cea5c2a83990375c7e2d29eef364736f6c63430008180033";
      const fileResponse = await JSONRPCRequest(this, "createFile", {
        keys: [fileCreateEd25519PublicKey],
        contents: systemContractBytecode,
        commonTransactionParams: {
          signers: [fileCreateEd25519PrivateKey],
        },
      });
      const fileId = fileResponse.fileId;

      const response = await JSONRPCRequest(this, "createContract", {
        bytecodeFileId: fileId,
        gas: "300000",
        commonTransactionParams: {
          signers: [fileCreateEd25519PrivateKey],
        },
      });
      expect(response.status).to.equal("SUCCESS");

      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.contractId.toString()).to.equal(response.contractId);
    });

    it("(#12) Create and deploy a valid contract and set the payer account that does not have sufficient funds", async function () {
      const fileResponse = await JSONRPCRequest(this, "createFile", {
        contents: smartContractBytecode,
      });
      const fileId = fileResponse.fileId;

      const payerPrivateKey = await generateEd25519PrivateKey(this);
      const payerAccountId = await createAccount(this, payerPrivateKey);

      await setOperator(this, payerAccountId, payerPrivateKey);

      try {
        await JSONRPCRequest(this, "createContract", {
          bytecodeFileId: fileId,
          gas,
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "INSUFFICIENT_PAYER_BALANCE",
          "insufficient balance",
        );
        return;
      }
      assert.fail("Should throw an error");
    });

    it("(#13) Create and deploy a valid contract and set the file ID to be a system file for exchange rate - 0.0.112", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          bytecodeFileId: "0.0.112",
          gas,
        });
      } catch (err: any) {
        assert.equal(err.data.status, "INVALID_FILE_ID", "invalid file id");
        return;
      }
      assert.fail("Should throw an error");
    });

    it("(#14) Create and deploy a valid contract and set the file ID to be a deleted file ID", async function () {
      const fileCreateEd25519PrivateKey = await generateEd25519PrivateKey(this);
      const fileCreateEd25519PublicKey = await generateEd25519PublicKey(
        this,
        fileCreateEd25519PrivateKey,
      );

      const createFileResponse = await JSONRPCRequest(this, "createFile", {
        keys: [fileCreateEd25519PublicKey],
        contents: smartContractBytecode,
        commonTransactionParams: {
          signers: [fileCreateEd25519PrivateKey],
        },
      });

      const fileId = createFileResponse.fileId;

      const deleteFileResponse = await JSONRPCRequest(this, "deleteFile", {
        fileId,
        commonTransactionParams: {
          signers: [fileCreateEd25519PrivateKey],
        },
      });

      expect(deleteFileResponse.status).to.equal("SUCCESS");

      try {
        await JSONRPCRequest(this, "createContract", {
          bytecodeFileId: fileId,
          gas,
        });
      } catch (err: any) {
        assert.equal(err.data.status, "FILE_DELETED", "file deleted");
        return;
      }
      assert.fail("Should throw an error");
    });
  });

  describe("Initcode", function () {
    const gas = "300000";
    it("(#1) Create a contract with valid initcode under the transaction size limit", async function () {
      const initcode = smartContractBytecode;
      const response = await JSONRPCRequest(this, "createContract", {
        initcode,
        gas,
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;

      // Verify contract was created successfully
      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.contractId.toString()).to.equal(response.contractId);
    });

    it("(#2) Create a contract with missing initcode AND missing bytecodeFileId", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          gas,
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "INVALID_FILE_ID",
          "Invalid file id error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#3) Create a contract with both valid initcode and valid bytecodeFileId supplied", async function () {
      const fileResponse = await JSONRPCRequest(this, "createFile", {
        contents: smartContractBytecode,
      });
      const fileId = fileResponse.fileId;

      const response = await JSONRPCRequest(this, "createContract", {
        initcode: smartContractBytecode,
        bytecodeFileId: fileId,
        gas,
      });

      expect(response.status).to.equal("SUCCESS");
    });

    it("(#4) Create a contract with an invalid initcode hex string", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          initcode: "0xZZ",
          gas,
        });
      } catch (err: any) {
        assert.equal(
          err.code,
          ErrorStatusCodes.INTERNAL_ERROR,
          "Internal error",
        );
        return;
      }
      assert.fail("Should throw an error");
    });

    // TODO: needs investigation
    it.skip("(#5) Create a contract with a valid initcode with constructorParameters", async function () {
      const constructorParameters = new ContractFunctionParameters()
        .addUint256(1)
        ._build();

      const initcode =
        "6080604052348015600e575f5ffd5b506040516101493803806101498339818101604052810190602e9190606b565b805f81905550506091565b5f5ffd5b5f819050919050565b604d81603d565b81146056575f5ffd5b50565b5f815190506065816046565b92915050565b5f60208284031215607d57607c6039565b5b5f6088848285016059565b91505092915050565b60ac8061009d5f395ff3fe6080604052348015600e575f5ffd5b50600436106026575f3560e01c80636d619daa14602a575b5f5ffd5b60306044565b604051603b9190605f565b60405180910390f35b5f5481565b5f819050919050565b6059816049565b82525050565b5f60208201905060705f8301846052565b9291505056fea2646970667358221220084a38ba3cab209cd2154230b84b3abc0ef94ea339d088a86544e2c56ffe557564736f6c634300081e0033";

      const response = await JSONRPCRequest(this, "createContract", {
        initcode,
        gas: "300000",
        constructorParameters: toHexString(constructorParameters),
      });
      expect(response.status).to.equal("SUCCESS");

      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.contractId.toString()).to.equal(response.contractId);
    });

    it("(#6) Create a contract with a valid initcode but insufficient gas", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          initcode: smartContractBytecode,
          gas: "0",
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "INSUFFICIENT_GAS",
          "Insufficient gas error",
        );
        return;
      }
      assert.fail("Should throw an error");
    });

    it("(#7) Create a contract with empty initcode", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          initcode: "",
          gas,
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "CONTRACT_BYTECODE_EMPTY",
          "Contract file empty error",
        );
        return;
      }
      assert.fail("Should throw an error");
    });
  });

  describe("Initial Balance", function () {
    const bytecode =
      "6080604052603e80600f5f395ff3fe60806040525f5ffdfea264697066735822122075befcb607eba7ac26552e70e14ad0b62dc41442ac32e038255f817e635c013164736f6c634300081e0033";
    const gas = "200000";

    this.timeout(30000);

    it("(#1) Create a contract with an admin key and valid initial balance", async function () {
      const ed25519PrivateKey = await generateEd25519PrivateKey(this);
      const ed25519PublicKey = await generateEd25519PublicKey(
        this,
        ed25519PrivateKey,
      );

      const response = await JSONRPCRequest(this, "createContract", {
        initcode: bytecode,
        gas,
        initialBalance: "1000",
        adminKey: ed25519PublicKey,
        commonTransactionParams: {
          signers: [ed25519PrivateKey],
        },
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;

      // Verify contract was created successfully
      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.contractId.toString()).to.equal(response.contractId);

      // Verify initial balance
      const accountInfo = await consensusInfoClient.getAccountInfo(
        response.contractId,
      );
      expect(accountInfo.balance.toTinybars().toString()).to.equal("1000");
    });

    it("(#2) Create a contract with no admin key and valid initial balance", async function () {
      const response = await JSONRPCRequest(this, "createContract", {
        initcode: bytecode,
        gas,
        initialBalance: "1000",
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;

      // Verify contract was created successfully
      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.contractId.toString()).to.equal(response.contractId);

      // Verify initial balance
      const accountInfo = await consensusInfoClient.getAccountInfo(
        response.contractId,
      );
      expect(accountInfo.balance.toTinybars().toString()).to.equal("1000");
    });

    it("(#3) Create a contract with no admin key and with zero initial balance", async function () {
      const response = await JSONRPCRequest(this, "createContract", {
        initcode: bytecode,
        gas,
        initialBalance: "0",
      });

      expect(response.status).to.equal("SUCCESS");

      // Verify contract was created successfully
      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.contractId.toString()).to.equal(response.contractId);

      // Verify initial balance
      const accountInfo = await consensusInfoClient.getAccountInfo(
        response.contractId,
      );
      expect(accountInfo.balance.toTinybars().toString()).to.equal("0");
    });

    it("(#4) Create a contract with an admin key and with zero initial balance", async function () {
      const ed25519PrivateKey = await generateEd25519PrivateKey(this);
      const ed25519PublicKey = await generateEd25519PublicKey(
        this,
        ed25519PrivateKey,
      );

      const response = await JSONRPCRequest(this, "createContract", {
        initcode: bytecode,
        gas,
        initialBalance: "0",
        adminKey: ed25519PublicKey,
        commonTransactionParams: {
          signers: [ed25519PrivateKey],
        },
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;

      // Verify contract was created successfully
      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.contractId.toString()).to.equal(response.contractId);

      // Verify initial balance
      const accountInfo = await consensusInfoClient.getAccountInfo(
        response.contractId,
      );
      expect(accountInfo.balance.toTinybars().toString()).to.equal("0");
    });

    it("(#5) Create a contract with an admin key and negative balance", async function () {
      const ed25519PrivateKey = await generateEd25519PrivateKey(this);
      const ed25519PublicKey = await generateEd25519PublicKey(
        this,
        ed25519PrivateKey,
      );

      try {
        await JSONRPCRequest(this, "createContract", {
          initcode: bytecode,
          gas,
          initialBalance: "-1000",
          adminKey: ed25519PublicKey,
          commonTransactionParams: {
            signers: [ed25519PrivateKey],
          },
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "CONTRACT_NEGATIVE_VALUE",
          "Invalid initial balance error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#6) Create a contract with no admin key and negative balance", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          initcode: bytecode,
          gas,
          initialBalance: "-1000",
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "CONTRACT_NEGATIVE_VALUE",
          "Invalid initial balance error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#7) Create a contract with an admin key and greater than payer balance", async function () {
      const payerAccountPrivateKey = await generateEd25519PrivateKey(this);
      const payerAccountId = await createAccount(this, payerAccountPrivateKey);

      await setOperator(this, payerAccountId, payerAccountPrivateKey);

      const ed25519PrivateKey = await generateEd25519PrivateKey(this);
      const ed25519PublicKey = await generateEd25519PublicKey(
        this,
        ed25519PrivateKey,
      );

      try {
        await JSONRPCRequest(this, "createContract", {
          initcode: bytecode,
          gas,
          initialBalance: "1000",
          adminKey: ed25519PublicKey,
          commonTransactionParams: {
            signers: [ed25519PrivateKey],
          },
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "INSUFFICIENT_PAYER_BALANCE",
          "Insufficient payer balance error",
        );
        return;
      }
      assert.fail("Should throw an error");
    });

    it("(#8) Create a contract with no admin key and greater than payer balance", async function () {
      const payerAccountPrivateKey = await generateEd25519PrivateKey(this);
      const payerAccountId = await createAccount(this, payerAccountPrivateKey);

      await setOperator(this, payerAccountId, payerAccountPrivateKey);

      try {
        await JSONRPCRequest(this, "createContract", {
          initcode: bytecode,
          gas,
          initialBalance: "1000",
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "INSUFFICIENT_PAYER_BALANCE",
          "Insufficient payer balance error",
        );
        return;
      }
      assert.fail("Should throw an error");
    });

    it("(#9) Create contract with admin key and initial balance = int64 min", async function () {
      const ed25519PrivateKey = await generateEd25519PrivateKey(this);
      const ed25519PublicKey = await generateEd25519PublicKey(
        this,
        ed25519PrivateKey,
      );

      try {
        await JSONRPCRequest(this, "createContract", {
          initcode: bytecode,
          gas,
          initialBalance: "-9223372036854775808",
          adminKey: ed25519PublicKey,
          commonTransactionParams: {
            signers: [ed25519PrivateKey],
          },
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "CONTRACT_NEGATIVE_VALUE",
          "Invalid initial balance error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#10) Create contract without admin key and initial balance = int64 min", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          initcode: bytecode,
          gas,
          initialBalance: "-9223372036854775808",
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "CONTRACT_NEGATIVE_VALUE",
          "Invalid initial balance error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#11) Create contract with admin key and initial balance = int64 min + 1", async function () {
      const ed25519PrivateKey = await generateEd25519PrivateKey(this);
      const ed25519PublicKey = await generateEd25519PublicKey(
        this,
        ed25519PrivateKey,
      );

      try {
        await JSONRPCRequest(this, "createContract", {
          initcode: bytecode,
          gas,
          initialBalance: "-9223372036854775807",
          adminKey: ed25519PublicKey,
          commonTransactionParams: {
            signers: [ed25519PrivateKey],
          },
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "CONTRACT_NEGATIVE_VALUE",
          "Invalid initial balance error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#12) Create contract without admin key and initial balance = int64 min + 1", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          initcode: bytecode,
          gas,
          initialBalance: "-9223372036854775807",
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "CONTRACT_NEGATIVE_VALUE",
          "Invalid initial balance error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#13) Create contract with admin key and initial balance = int64 max - 1", async function () {
      const ed25519PrivateKey = await generateEd25519PrivateKey(this);
      const ed25519PublicKey = await generateEd25519PublicKey(
        this,
        ed25519PrivateKey,
      );

      try {
        await JSONRPCRequest(this, "createContract", {
          initcode: bytecode,
          gas,
          initialBalance: "9223372036854775807",
          adminKey: ed25519PublicKey,
          commonTransactionParams: {
            signers: [ed25519PrivateKey],
          },
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          // TODO: fail invalid
          "FAIL_INVALID",
          "Insufficient payer balance error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#14) Create contract without admin key and initial balance = int64 max - 1", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          initcode: bytecode,
          gas,
          initialBalance: "9223372036854775806",
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          // TODO fail invalid
          "FAIL_INVALID",
          "Insufficient payer balance error",
        );
        return;
      }
    });

    it("(#15) Create contract with admin key and initial balance = int64 max", async function () {
      const ed25519PrivateKey = await generateEd25519PrivateKey(this);
      const ed25519PublicKey = await generateEd25519PublicKey(
        this,
        ed25519PrivateKey,
      );

      try {
        await JSONRPCRequest(this, "createContract", {
          initcode: bytecode,
          gas,
          initialBalance: "9223372036854775807",
          adminKey: ed25519PublicKey,
          commonTransactionParams: {
            signers: [ed25519PrivateKey],
          },
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          // TODO: fail invalid
          "FAIL_INVALID",
          "Insufficient payer balance error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#16) Create contract without admin key and initial balance = int64 max", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          initcode: bytecode,
          gas,
          initialBalance: "9223372036854775807",
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          // TODO: fail invalid
          "FAIL_INVALID",
          "Insufficient payer balance error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });
  });

  describe("Constructor Parameters", function () {
    const gas = "300000";
    const bytecode =
      "6080604052348015600e575f5ffd5b506040516101493803806101498339818101604052810190602e9190606b565b805f81905550506091565b5f5ffd5b5f819050919050565b604d81603d565b81146056575f5ffd5b50565b5f815190506065816046565b92915050565b5f60208284031215607d57607c6039565b5b5f6088848285016059565b91505092915050565b60ac8061009d5f395ff3fe6080604052348015600e575f5ffd5b50600436106026575f3560e01c80636d619daa14602a575b5f5ffd5b60306044565b604051603b9190605f565b60405180910390f35b5f5481565b5f819050919050565b6059816049565b82525050565b5f60208201905060705f8301846052565b9291505056fea2646970667358221220084a38ba3cab209cd2154230b84b3abc0ef94ea339d088a86544e2c56ffe557564736f6c634300081e0033";

    it("(#1) Create contract with admin key and valid ABIencoded parameters", async function () {
      const fileResponse = await JSONRPCRequest(this, "createFile", {
        contents: bytecode,
      });
      const fileId = fileResponse.fileId;
      const ed25519PrivateKey = await generateEd25519PrivateKey(this);
      const ed25519PublicKey = await generateEd25519PublicKey(
        this,
        ed25519PrivateKey,
      );

      const constructorParams = new ContractFunctionParameters()
        .addUint256(1)
        ._build();

      const response = await JSONRPCRequest(this, "createContract", {
        bytecodeFileId: fileId,
        gas,
        adminKey: ed25519PublicKey,
        constructorParameters: toHexString(constructorParams),
        commonTransactionParams: {
          signers: [ed25519PrivateKey],
        },
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;

      // Verify contract was created successfully
      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.contractId.toString()).to.equal(response.contractId);
    });

    it("(#2) Create contract without admin key and valid ABIencoded parameters", async function () {
      const fileResponse = await JSONRPCRequest(this, "createFile", {
        contents: bytecode,
      });
      const fileId = fileResponse.fileId;

      const constructorParams = new ContractFunctionParameters()
        .addUint256(1)
        ._build();

      const response = await JSONRPCRequest(this, "createContract", {
        bytecodeFileId: fileId,
        gas,
        constructorParameters: toHexString(constructorParams),
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;

      // Verify contract was created successfully
      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.contractId.toString()).to.equal(response.contractId);
    });

    it("(#3) Create contract with admin key and invalid hex string", async function () {
      const ed25519PrivateKey = await generateEd25519PrivateKey(this);
      const ed25519PublicKey = await generateEd25519PublicKey(
        this,
        ed25519PrivateKey,
      );

      const fileResponse = await JSONRPCRequest(this, "createFile", {
        contents: bytecode,
      });
      const fileId = fileResponse.fileId;

      try {
        await JSONRPCRequest(this, "createContract", {
          bytecodeFileId: fileId,
          gas,
          adminKey: ed25519PublicKey,
          commonTransactionParams: {
            signers: [ed25519PrivateKey],
          },
          constructorParameters: "0xZZ",
        });
      } catch (err: any) {
        assert.equal(
          err.code,
          ErrorStatusCodes.INTERNAL_ERROR,
          "Internal error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#4) Create contract without admin key and invalid hex string", async function () {
      const fileResponse = await JSONRPCRequest(this, "createFile", {
        contents: bytecode,
      });
      const fileId = fileResponse.fileId;

      try {
        await JSONRPCRequest(this, "createContract", {
          bytecodeFileId: fileId,
          gas,
          constructorParameters: "0xZZ",
        });
      } catch (err: any) {
        assert.equal(
          err.code,
          ErrorStatusCodes.INTERNAL_ERROR,
          "Internal error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#5) Create contract with admin key and oversized constructor parameters", async function () {
      const ed25519PrivateKey = await generateEd25519PrivateKey(this);
      const ed25519PublicKey = await generateEd25519PublicKey(
        this,
        ed25519PrivateKey,
      );

      const fileResponse = await JSONRPCRequest(this, "createFile", {
        contents:
          "608060405234801561000f575f5ffd5b506040516101fb3803806101fb833981810160405281019061003191906100d4565b805f5f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550506100ff565b5f5ffd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6100a38261007a565b9050919050565b6100b381610099565b81146100bd575f5ffd5b50565b5f815190506100ce816100aa565b92915050565b5f602082840312156100e9576100e8610076565b5b5f6100f6848285016100c0565b91505092915050565b60f08061010b5f395ff3fe6080604052348015600e575f5ffd5b50600436106026575f3560e01c80636d619daa14602a575b5f5ffd5b60306044565b604051603b919060a3565b60405180910390f35b5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f608f826068565b9050919050565b609d816087565b82525050565b5f60208201905060b45f8301846096565b9291505056fea2646970667358221220465e188fcf3a681c75a48154a23316e61ee35f29ee5908e42d53f793acd1f8ef64736f6c634300081e0033",
      });
      const fileId = fileResponse.fileId;

      const constructorParams = "a".repeat(5500);

      try {
        await JSONRPCRequest(this, "createContract", {
          bytecodeFileId: fileId,
          gas,
          adminKey: ed25519PublicKey,
          commonTransactionParams: {
            signers: [ed25519PrivateKey],
          },
          constructorParameters: constructorParams,
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "CONTRACT_REVERT_EXECUTED",
          "Contract revert executed error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#6) Create contract without admin key and oversized constructor parameters", async function () {
      const fileResponse = await JSONRPCRequest(this, "createFile", {
        contents:
          "608060405234801561000f575f5ffd5b506040516101fb3803806101fb833981810160405281019061003191906100d4565b805f5f6101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550506100ff565b5f5ffd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6100a38261007a565b9050919050565b6100b381610099565b81146100bd575f5ffd5b50565b5f815190506100ce816100aa565b92915050565b5f602082840312156100e9576100e8610076565b5b5f6100f6848285016100c0565b91505092915050565b60f08061010b5f395ff3fe6080604052348015600e575f5ffd5b50600436106026575f3560e01c80636d619daa14602a575b5f5ffd5b60306044565b604051603b919060a3565b60405180910390f35b5f5f9054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f608f826068565b9050919050565b609d816087565b82525050565b5f60208201905060b45f8301846096565b9291505056fea2646970667358221220465e188fcf3a681c75a48154a23316e61ee35f29ee5908e42d53f793acd1f8ef64736f6c634300081e0033",
      });
      const fileId = fileResponse.fileId;

      const constructorParams = "a".repeat(5500);

      try {
        await JSONRPCRequest(this, "createContract", {
          bytecodeFileId: fileId,
          gas,
          constructorParameters: constructorParams,
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "CONTRACT_REVERT_EXECUTED",
          "Contract revert executed error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });
  });

  describe.skip("Gas", function () {
    const gas = "300000";
    it("(#1) Creates a contract with admin key and reasonable gas", async function () {
      const ed25519PrivateKey = await generateEd25519PrivateKey(this);
      const ed25519PublicKey = await generateEd25519PublicKey(
        this,
        ed25519PrivateKey,
      );

      const response = await JSONRPCRequest(this, "createContract", {
        initcode: smartContractBytecode,
        gas,
        adminKey: ed25519PublicKey,
        commonTransactionParams: {
          signers: [ed25519PrivateKey],
        },
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;

      // Verify contract was created successfully
      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.contractId.toString()).to.equal(response.contractId);
    });

    it("(#2) Creates a contract with no admin key and reasonable gas", async function () {
      const response = await JSONRPCRequest(this, "createContract", {
        initcode: smartContractBytecode,
        gas,
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;

      // Verify contract was created successfully
      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.contractId.toString()).to.equal(response.contractId);
    });

    it("(#3) Creates a contract with zero gas", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          initcode: smartContractBytecode,
          gas: "0",
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "INSUFFICIENT_GAS",
          "Insufficient gas error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#4) Creates a contract with negative gas", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          initcode: smartContractBytecode,
          gas: "-1",
        });
      } catch (err: any) {
        assert.equal(
          err.code,
          ErrorStatusCodes.INTERNAL_ERROR,
          "Internal error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#5) Creates a contract with gas at int64 min", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          initcode: smartContractBytecode,
          gas: "-9223372036854775808",
        });
      } catch (err: any) {
        assert.equal(
          err.code,
          ErrorStatusCodes.INTERNAL_ERROR,
          "Internal error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#6) Creates a contract with gas at int64 min + 1", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          initcode: smartContractBytecode,
          gas: "-9223372036854775807",
        });
      } catch (err: any) {
        assert.equal(
          err.code,
          ErrorStatusCodes.INTERNAL_ERROR,
          "Internal error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });
  });

  describe("Memo", function () {
    let ed25519PrivateKey: string;
    let ed25519PublicKey: string;
    let commonContractParams: any;

    beforeEach(async function () {
      ed25519PrivateKey = await generateEd25519PrivateKey(this);
      ed25519PublicKey = await generateEd25519PublicKey(
        this,
        ed25519PrivateKey,
      );

      commonContractParams = {
        initcode: smartContractBytecode,
        gas: "300000",
        adminKey: ed25519PublicKey,
        commonTransactionParams: {
          signers: [ed25519PrivateKey],
        },
      };
    });

    const verifyContractCreationWithMemo = async (
      contractId: string,
      memo: string,
    ) => {
      // Verify memo via consensus node
      const contractInfo =
        await consensusInfoClient.getContractInfo(contractId);
      expect(contractInfo.contractMemo).to.equal(memo);

      // Verify memo via mirror node (with retry for eventual consistency)
      await retryOnError(async () => {
        const mirrorContractInfo =
          await mirrorNodeClient.getContractData(contractId);
        expect(mirrorContractInfo.memo).to.equal(memo);
      });
    };

    it("(#1) Creates a contract with valid memo", async function () {
      const memo = "Test contract memo";

      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        memo,
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      await verifyContractCreationWithMemo(response.contractId, memo);
    });

    it("(#2) Creates a contract with empty memo", async function () {
      const memo = "";

      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        memo,
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      await verifyContractCreationWithMemo(response.contractId, memo);
    });

    it("(#3) Creates a contract with memo at maximum length (100 bytes)", async function () {
      const memo = "a".repeat(100);

      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        memo,
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      await verifyContractCreationWithMemo(response.contractId, memo);
    });

    it("(#4) Creates a contract with memo exceeding maximum length", async function () {
      try {
        const memo = "a".repeat(101);

        await JSONRPCRequest(this, "createContract", {
          ...commonContractParams,
          memo,
        });
      } catch (err: any) {
        assert.equal(err.data.status, "MEMO_TOO_LONG", "Memo too long error");
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#5) Creates a contract with memo containing null byte", async function () {
      try {
        const memo = "Test\0memo";

        await JSONRPCRequest(this, "createContract", {
          ...commonContractParams,
          memo,
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "INVALID_ZERO_BYTE_IN_STRING",
          "Invalid zero byte in string error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#6) Creates a contract with memo containing only whitespace", async function () {
      const memo = "   ";

      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        memo,
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      await verifyContractCreationWithMemo(response.contractId, memo);
    });

    it("(#7) Creates a contract with memo containing special characters", async function () {
      const memo = "!@#$%^&*()_+-=[]{};':\",./<>?";

      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        memo,
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      await verifyContractCreationWithMemo(response.contractId, memo);
    });

    it("(#8) Creates a contract with memo containing unicode characters", async function () {
      const memo = " ";

      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        memo,
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      await verifyContractCreationWithMemo(response.contractId, memo);
    });
  });

  describe("AutoRenewPeriod", function () {
    let ed25519PrivateKey: string;
    let ed25519PublicKey: string;
    let commonContractParams: any;

    beforeEach(async function () {
      ed25519PrivateKey = await generateEd25519PrivateKey(this);
      ed25519PublicKey = await generateEd25519PublicKey(
        this,
        ed25519PrivateKey,
      );

      commonContractParams = {
        initcode: smartContractBytecode,
        gas: "300000",
        adminKey: ed25519PublicKey,
        commonTransactionParams: {
          signers: [ed25519PrivateKey],
        },
      };
    });

    const verifyContractCreationWithAutoRenewPeriod = async (
      contractId: string,
      expectedAutoRenewPeriod: string,
    ) => {
      // Verify auto renew period via consensus node
      const contractInfo =
        await consensusInfoClient.getContractInfo(contractId);
      expect(contractInfo.autoRenewPeriod?.seconds?.toString()).to.equal(
        expectedAutoRenewPeriod,
      );

      // Verify auto renew period via mirror node (with retry for eventual consistency)
      await retryOnError(async () => {
        const mirrorContractInfo =
          await mirrorNodeClient.getContractData(contractId);
        expect(mirrorContractInfo.auto_renew_period?.toString()).to.equal(
          expectedAutoRenewPeriod,
        );
      });
    };

    it("(#1) Creates a contract with valid auto renew period", async function () {
      const autoRenewPeriod = "7000000";

      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        autoRenewPeriod,
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      await verifyContractCreationWithAutoRenewPeriod(
        response.contractId,
        autoRenewPeriod,
      );
    });

    it("(#2) Creates a contract with minimum auto renew period", async function () {
      const autoRenewPeriod = "2592000"; // 30 days

      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        autoRenewPeriod,
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      await verifyContractCreationWithAutoRenewPeriod(
        response.contractId,
        autoRenewPeriod,
      );
    });

    it("(#3) Creates a contract with maximum auto renew period", async function () {
      const autoRenewPeriod = "8000001"; // Maximum valid period

      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        autoRenewPeriod,
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      await verifyContractCreationWithAutoRenewPeriod(
        response.contractId,
        autoRenewPeriod,
      );
    });

    it("(#4) Creates a contract with auto renew period below minimum", async function () {
      try {
        const autoRenewPeriod = "2591999"; // Below minimum

        await JSONRPCRequest(this, "createContract", {
          ...commonContractParams,
          autoRenewPeriod,
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "AUTORENEW_DURATION_NOT_IN_RANGE",
          "Auto renew duration below minimum error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#5) Creates a contract with auto renew period above maximum", async function () {
      try {
        const autoRenewPeriod = "300000"; // Above maximum

        await JSONRPCRequest(this, "createContract", {
          ...commonContractParams,
          autoRenewPeriod,
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "AUTORENEW_DURATION_NOT_IN_RANGE",
          "Auto renew duration above maximum error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#6) Creates a contract with auto renew period of zero", async function () {
      try {
        const autoRenewPeriod = "0";

        await JSONRPCRequest(this, "createContract", {
          ...commonContractParams,
          autoRenewPeriod,
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "INVALID_RENEWAL_PERIOD",
          "Invalid renewal period",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#7) Creates a contract with negative auto renew period", async function () {
      try {
        const autoRenewPeriod = "-1";

        await JSONRPCRequest(this, "createContract", {
          ...commonContractParams,
          autoRenewPeriod,
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "INVALID_RENEWAL_PERIOD",
          "Invalid renewal period",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#8) Creates a contract with auto renew period of int64 max", async function () {
      try {
        const autoRenewPeriod = "9223372036854775807"; // int64 max

        await JSONRPCRequest(this, "createContract", {
          ...commonContractParams,
          autoRenewPeriod,
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "INVALID_RENEWAL_PERIOD",
          "Auto renew duration int64 max error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#9) Creates a contract with auto renew period of int64 min", async function () {
      try {
        const autoRenewPeriod = "-9223372036854775808"; // int64 min

        await JSONRPCRequest(this, "createContract", {
          ...commonContractParams,
          autoRenewPeriod,
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "INVALID_RENEWAL_PERIOD",
          "Invalid renewal period",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#10) Creates a contract without auto renew period", async function () {
      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        memo: "Contract without auto renew period",
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;

      // Verify the default auto renew period is applied
      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      const defaultAutoRenewPeriod =
        contractInfo.autoRenewPeriod?.seconds?.toString();

      // Verify via mirror node
      await retryOnError(async () => {
        const mirrorContractInfo = await mirrorNodeClient.getContractData(
          response.contractId,
        );
        expect(mirrorContractInfo.auto_renew_period?.toString()).to.equal(
          defaultAutoRenewPeriod,
        );
      });
    });
  });

  describe("AutoRenewAccountId", function () {
    const verifyContractCreationWithAutoRenewAccount = async (
      contractId: string,
      expectedAutoRenewAccount: string | null,
    ) => {
      // Verify auto renew account via consensus node
      const contractInfo =
        await consensusInfoClient.getContractInfo(contractId);

      if (expectedAutoRenewAccount === null) {
        expect(contractInfo.autoRenewAccountId).to.be.null;
      } else {
        expect(contractInfo.autoRenewAccountId?.toString()).to.equal(
          expectedAutoRenewAccount,
        );
      }

      // Verify auto renew account via mirror node
      await retryOnError(async () => {
        const mirrorContractInfo =
          await mirrorNodeClient.getContractData(contractId);
        if (expectedAutoRenewAccount === null) {
          expect(mirrorContractInfo.auto_renew_account).to.be.null;
        } else {
          expect(mirrorContractInfo.auto_renew_account?.toString()).to.equal(
            expectedAutoRenewAccount,
          );
        }
      });
    };

    it("(#1) Creates a contract with valid auto renew account", async function () {
      const initcode = smartContractBytecode;

      // Create an account to use as auto renew account
      const autoRenewAccountPrivateKey = await generateEd25519PrivateKey(this);
      const autoRenewAccountId = await createAccount(
        this,
        autoRenewAccountPrivateKey,
      );

      const response = await JSONRPCRequest(this, "createContract", {
        initcode,
        autoRenewAccountId,
        gas: "300000",
        commonTransactionParams: {
          signers: [autoRenewAccountPrivateKey],
        },
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      await verifyContractCreationWithAutoRenewAccount(
        response.contractId,
        autoRenewAccountId,
      );
    });

    it("(#2) Creates a contract with non-existent auto renew account", async function () {
      try {
        const initcode = smartContractBytecode;

        await JSONRPCRequest(this, "createContract", {
          initcode,
          autoRenewAccountId: "0.0.999999", // Non-existent account
          gas: "300000",
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "INVALID_AUTORENEW_ACCOUNT",
          "Invalid auto renew account error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#3) Creates a contract with deleted auto renew account", async function () {
      const initcode = smartContractBytecode;

      // Create an account and then delete it
      const accountPrivateKey = await generateEd25519PrivateKey(this);
      const deletedAccountId = await createAccount(this, accountPrivateKey);

      // Delete the account
      await JSONRPCRequest(this, "deleteAccount", {
        deleteAccountId: deletedAccountId,
        transferAccountId: process.env.OPERATOR_ACCOUNT_ID,
        commonTransactionParams: {
          signers: [accountPrivateKey],
        },
      });

      try {
        await JSONRPCRequest(this, "createContract", {
          initcode,
          autoRenewAccountId: deletedAccountId,
          gas: "300000",
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "INVALID_SIGNATURE",
          "Invalid signature error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#4) Creates a contract with no auto renew account", async function () {
      const initcode = smartContractBytecode;

      const response = await JSONRPCRequest(this, "createContract", {
        initcode,
        gas: "300000",
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
    });

    it("(#5) Creates a contract with invalid auto renew account format", async function () {
      try {
        const initcode = smartContractBytecode;

        await JSONRPCRequest(this, "createContract", {
          initcode,
          autoRenewAccountId: "invalid", // Invalid format
          gas: "300000",
        });
      } catch (err: any) {
        assert.equal(
          err.code,
          ErrorStatusCodes.INTERNAL_ERROR,
          "Internal error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });
  });

  describe("DeclineStakingReward", function () {
    let ed25519PrivateKey: string;
    let ed25519PublicKey: string;
    let commonContractParams: any;

    beforeEach(async function () {
      ed25519PrivateKey = await generateEd25519PrivateKey(this);
      ed25519PublicKey = await generateEd25519PublicKey(
        this,
        ed25519PrivateKey,
      );

      commonContractParams = {
        initcode: smartContractBytecode,
        gas: "300000",
      };
    });

    it("(#1) Create a contract with an admin key that decline staking rewards", async function () {
      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        adminKey: ed25519PublicKey,
        declineStakingReward: true,
        commonTransactionParams: {
          signers: [ed25519PrivateKey],
        },
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;

      // Verify contract was created successfully
      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );

      expect(contractInfo.stakingInfo?.declineStakingReward).to.equal(true);
    });

    it("(#2) Create a contract with no admin key that decline staking rewards", async function () {
      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        declineStakingReward: true,
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;

      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.stakingInfo?.declineStakingReward).to.equal(true);
    });

    it("(#3) Create a contract with an admin key that that accept staking rewards", async function () {
      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        adminKey: ed25519PublicKey,
        declineStakingReward: false,
        commonTransactionParams: {
          signers: [ed25519PrivateKey],
        },
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;

      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.stakingInfo?.declineStakingReward).to.equal(false);
    });

    it("(#4) Create a contract with no admin key that accept staking rewards", async function () {
      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        declineStakingReward: false,
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;

      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.stakingInfo?.declineStakingReward).to.equal(false);
    });
  });

  describe("MaxAutomaticTokenAssociations", function () {
    let ed25519PrivateKey: string;
    let ed25519PublicKey: string;
    let commonContractParams: any;

    beforeEach(async function () {
      ed25519PrivateKey = await generateEd25519PrivateKey(this);
      ed25519PublicKey = await generateEd25519PublicKey(
        this,
        ed25519PrivateKey,
      );

      commonContractParams = {
        initcode: smartContractBytecode,
        gas: "300000",
      };
    });

    it("(#1) Create contract with admin key and maxAutomaticTokenAssociations = 0", async function () {
      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        adminKey: ed25519PublicKey,
        maxAutomaticTokenAssociations: 0,
        commonTransactionParams: {
          signers: [ed25519PrivateKey],
        },
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;

      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.maxAutomaticTokenAssociations.toNumber()).to.equal(0);

      await retryOnError(async () => {
        const mirrorContractInfo = await mirrorNodeClient.getContractData(
          response.contractId,
        );
        expect(mirrorContractInfo.max_automatic_token_associations).to.equal(0);
      });
    });

    it("(#2) Create contract without admin key and maxAutomaticTokenAssociations = 0", async function () {
      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        maxAutomaticTokenAssociations: 0,
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.maxAutomaticTokenAssociations.toNumber()).to.equal(0);

      await retryOnError(async () => {
        const mirrorContractInfo = await mirrorNodeClient.getContractData(
          response.contractId,
        );
        expect(mirrorContractInfo.max_automatic_token_associations).to.equal(0);
      });
    });

    it("(#3) Create contract with admin key and maxAutomaticTokenAssociations = 10", async function () {
      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        adminKey: ed25519PublicKey,
        maxAutomaticTokenAssociations: 10,
        commonTransactionParams: {
          signers: [ed25519PrivateKey],
        },
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.maxAutomaticTokenAssociations.toNumber()).to.equal(
        10,
      );

      await retryOnError(async () => {
        const mirrorContractInfo = await mirrorNodeClient.getContractData(
          response.contractId,
        );
        expect(mirrorContractInfo.max_automatic_token_associations).to.equal(
          10,
        );
      });
    });

    it("(#4) Create contract without admin key and maxAutomaticTokenAssociations = 10", async function () {
      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        maxAutomaticTokenAssociations: 10,
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.maxAutomaticTokenAssociations.toNumber()).to.equal(
        10,
      );

      await retryOnError(async () => {
        const mirrorContractInfo = await mirrorNodeClient.getContractData(
          response.contractId,
        );
        expect(mirrorContractInfo.max_automatic_token_associations).to.equal(
          10,
        );
      });
    });

    it("(#5) Create contract with admin key and maxAutomaticTokenAssociations = 1000", async function () {
      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        adminKey: ed25519PublicKey,
        maxAutomaticTokenAssociations: 1000,
        commonTransactionParams: {
          signers: [ed25519PrivateKey],
        },
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.maxAutomaticTokenAssociations.toNumber()).to.equal(
        1000,
      );

      await retryOnError(async () => {
        const mirrorContractInfo = await mirrorNodeClient.getContractData(
          response.contractId,
        );
        expect(mirrorContractInfo.max_automatic_token_associations).to.equal(
          1000,
        );
      });
    });

    it("(#6) Create contract without admin key and maxAutomaticTokenAssociations = 1000", async function () {
      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        maxAutomaticTokenAssociations: 1000,
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.maxAutomaticTokenAssociations.toNumber()).to.equal(
        1000,
      );

      await retryOnError(async () => {
        const mirrorContractInfo = await mirrorNodeClient.getContractData(
          response.contractId,
        );
        expect(mirrorContractInfo.max_automatic_token_associations).to.equal(
          1000,
        );
      });
    });

    it("(#7) Create contract with admin key and maxAutomaticTokenAssociations = -1 (no-limit per HIP-904)", async function () {
      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        adminKey: ed25519PublicKey,
        maxAutomaticTokenAssociations: -1,
        commonTransactionParams: {
          signers: [ed25519PrivateKey],
        },
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.maxAutomaticTokenAssociations.toNumber()).to.equal(
        -1,
      );

      await retryOnError(async () => {
        const mirrorContractInfo = await mirrorNodeClient.getContractData(
          response.contractId,
        );
        expect(mirrorContractInfo.max_automatic_token_associations).to.equal(
          -1,
        );
      });
    });

    it("(#8) Create contract without admin key and maxAutomaticTokenAssociations = -1 (no-limit per HIP-904)", async function () {
      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        maxAutomaticTokenAssociations: -1,
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.maxAutomaticTokenAssociations.toNumber()).to.equal(
        -1,
      );

      await retryOnError(async () => {
        const mirrorContractInfo = await mirrorNodeClient.getContractData(
          response.contractId,
        );
        expect(mirrorContractInfo.max_automatic_token_associations).to.equal(
          -1,
        );
      });
    });

    it("(#9) Create contract with admin key and invalid negative maxAutomaticTokenAssociations = -2", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          ...commonContractParams,
          adminKey: ed25519PublicKey,
          maxAutomaticTokenAssociations: -2,
          commonTransactionParams: {
            signers: [ed25519PrivateKey],
          },
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "INVALID_MAX_AUTO_ASSOCIATIONS",
          "Invalid max auto associations error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#10) Create contract without admin key and invalid negative maxAutomaticTokenAssociations = -2", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          ...commonContractParams,
          maxAutomaticTokenAssociations: -2,
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "INVALID_MAX_AUTO_ASSOCIATIONS",
          "Invalid max auto associations error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#11) Create contract with admin key and maxAutomaticTokenAssociations equal to used_auto_associations (3)", async function () {
      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        adminKey: ed25519PublicKey,
        maxAutomaticTokenAssociations: 3,
        commonTransactionParams: {
          signers: [ed25519PrivateKey],
        },
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.maxAutomaticTokenAssociations.toNumber()).to.equal(3);

      await retryOnError(async () => {
        const mirrorContractInfo = await mirrorNodeClient.getContractData(
          response.contractId,
        );
        expect(mirrorContractInfo.max_automatic_token_associations).to.equal(3);
      });
    });

    it("(#12) Create contract without admin key and maxAutomaticTokenAssociations equal to used_auto_associations", async function () {
      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        maxAutomaticTokenAssociations: 3,
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.maxAutomaticTokenAssociations.toNumber()).to.equal(3);

      await retryOnError(async () => {
        const mirrorContractInfo = await mirrorNodeClient.getContractData(
          response.contractId,
        );
        expect(mirrorContractInfo.max_automatic_token_associations).to.equal(3);
      });
    });

    it("(#13) Create contract with admin key and maxAutomaticTokenAssociations < used_auto_associations (1 < 3)", async function () {
      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        adminKey: ed25519PublicKey,
        maxAutomaticTokenAssociations: 1,
        commonTransactionParams: {
          signers: [ed25519PrivateKey],
        },
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.maxAutomaticTokenAssociations.toNumber()).to.equal(1);

      await retryOnError(async () => {
        const mirrorContractInfo = await mirrorNodeClient.getContractData(
          response.contractId,
        );
        expect(mirrorContractInfo.max_automatic_token_associations).to.equal(1);
      });
    });

    it("(#14) Create contract without admin key and maxAutomaticTokenAssociations < used_auto_associations (1 < 3)", async function () {
      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        maxAutomaticTokenAssociations: 1,
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      const contractInfo = await consensusInfoClient.getContractInfo(
        response.contractId,
      );
      expect(contractInfo.maxAutomaticTokenAssociations.toNumber()).to.equal(1);

      await retryOnError(async () => {
        const mirrorContractInfo = await mirrorNodeClient.getContractData(
          response.contractId,
        );
        expect(mirrorContractInfo.max_automatic_token_associations).to.equal(1);
      });
    });

    it("(#15) Create contract without admin key and maxAutomaticTokenAssociations = 2,147,483,647", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          ...commonContractParams,
          maxAutomaticTokenAssociations: 2147483647,
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "REQUESTED_NUM_AUTOMATIC_ASSOCIATIONS_EXCEEDS_ASSOCIATION_LIMIT",
          "Requested num automatic associations exceeds association limit error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#16) Create contract with admin key and maxAutomaticTokenAssociations = 2,147,483,647", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          ...commonContractParams,
          adminKey: ed25519PublicKey,
          maxAutomaticTokenAssociations: 2147483647,
          commonTransactionParams: {
            signers: [ed25519PrivateKey],
          },
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "REQUESTED_NUM_AUTOMATIC_ASSOCIATIONS_EXCEEDS_ASSOCIATION_LIMIT",
          "Requested num automatic associations exceeds association limit error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#17) Create contract without admin key and maxAutomaticTokenAssociations = -2,147,483,647", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          ...commonContractParams,
          maxAutomaticTokenAssociations: -2147483647,
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "INVALID_MAX_AUTO_ASSOCIATIONS",
          "Invalid max auto associations error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#18) Create contract with admin key and maxAutomaticTokenAssociations = -2,147,483,647", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          ...commonContractParams,
          adminKey: ed25519PublicKey,
          maxAutomaticTokenAssociations: -2147483647,
          commonTransactionParams: {
            signers: [ed25519PrivateKey],
          },
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "INVALID_MAX_AUTO_ASSOCIATIONS",
          "Invalid max auto associations error",
        );
        return;
      }

      assert.fail("Should throw an error");
    });
  });

  describe("Admin Key", function () {
    let ed25519PrivateKey: string;
    let ed25519PublicKey: string;
    let commonContractParamsBase: any;

    beforeEach(async function () {
      ed25519PrivateKey = await generateEd25519PrivateKey(this);
      ed25519PublicKey = await generateEd25519PublicKey(
        this,
        ed25519PrivateKey,
      );

      commonContractParamsBase = {
        initcode: smartContractBytecode,
        gas: "300000",
      };
    });

    const verifyContractCreationWithAdminKey = async (
      contractId: string,
      adminKey: string | null,
    ) => {
      if (adminKey === null) {
        await verifyContractUpdateWithNullKey(contractId, "adminKey");
      } else {
        await verifyContractKey(contractId, adminKey, "adminKey");
      }
    };

    it("(#1) Create a contract with a valid ED25519 public key as its admin key", async function () {
      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParamsBase,
        adminKey: ed25519PublicKey,
        commonTransactionParams: { signers: [ed25519PrivateKey] },
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      await verifyContractCreationWithAdminKey(
        response.contractId,
        ed25519PublicKey,
      );
    });

    it("(#2) Create a contract with a valid ECDSA key as its admin key", async function () {
      const ecdsaPriv = await generateEcdsaSecp256k1PrivateKey(this);
      const ecdsaPub = await generateEcdsaSecp256k1PublicKey(this, ecdsaPriv);

      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParamsBase,
        adminKey: ecdsaPub,
        commonTransactionParams: { signers: [ecdsaPriv] },
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      await verifyContractCreationWithAdminKey(response.contractId, ecdsaPub);
    });

    it("(#3) Create a contract with an invalid key format", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          ...commonContractParamsBase,
          adminKey: invalidKey,
        });
      } catch (err: any) {
        // SDK error (invalid key encoding)
        assert.equal(
          err.code,
          ErrorStatusCodes.INTERNAL_ERROR,
          "Internal error",
        );
        return;
      }
      assert.fail("Should throw an error");
    });

    it.skip("(#4) Create a contract with no adminKey", async function () {
      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParamsBase,
      });
      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;

      await verifyContractCreationWithAdminKey(response.contractId, null);
    });

    it("(#5) Create a contract with an admin key too large (invalid)", async function () {
      // Reuse invalidKey as an oversized/invalid-encoded key sample
      try {
        await JSONRPCRequest(this, "createContract", {
          ...commonContractParamsBase,
          adminKey: invalidKey + invalidKey, // force oversize
        });
      } catch (err: any) {
        assert.equal(
          err.code,
          ErrorStatusCodes.INTERNAL_ERROR,
          "Internal error",
        );
        return;
      }
      assert.fail("Should throw an error");
    });

    it("(#6) Create a contract with an ED25519 complex admin key structure (KeyList)", async function () {
      const keyList = await generateKeyList(this, {
        type: "keyList",
        keys: [
          { type: "ed25519PublicKey" },
          { type: "ed25519PublicKey" },
          { type: "ed25519PublicKey" },
        ],
      });

      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParamsBase,
        adminKey: keyList.key,
        commonTransactionParams: { signers: keyList.privateKeys },
      });
      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      await verifyContractKeyList(response.contractId, keyList.key, "adminKey");
    });

    it("(#7) Create a contract with an ECDSA complex admin key structure (KeyList)", async function () {
      const keyList = await generateKeyList(this, {
        type: "keyList",
        keys: [
          { type: "ecdsaSecp256k1PublicKey" },
          { type: "ecdsaSecp256k1PublicKey" },
          { type: "ecdsaSecp256k1PublicKey" },
        ],
      });

      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParamsBase,
        adminKey: keyList.key,
        commonTransactionParams: { signers: keyList.privateKeys },
      });
      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      await verifyContractKeyList(response.contractId, keyList.key, "adminKey");
    });

    it("(#8) Create a contract with an ED25519 private key as the admin key", async function () {
      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParamsBase,
        adminKey: ed25519PrivateKey,
        commonTransactionParams: { signers: [ed25519PrivateKey] },
      });
      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      await verifyContractCreationWithAdminKey(
        response.contractId,
        ed25519PublicKey,
      );
    });

    it("(#9) Create a contract with an ECDSA private key as the admin key", async function () {
      const ecdsaPriv = await generateEcdsaSecp256k1PrivateKey(this);
      const ecdsaPub = await generateEcdsaSecp256k1PublicKey(this, ecdsaPriv);
      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParamsBase,
        adminKey: ecdsaPriv,
        commonTransactionParams: { signers: [ecdsaPriv] },
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      await verifyContractCreationWithAdminKey(response.contractId, ecdsaPub);
    });

    it("(#10) Create a contract with valid KeyList of ED25519 and ECDSAsecp256k1 private and public keys as its admin key", async function () {
      const keyList = await generateKeyList(this, {
        type: "keyList",
        keys: [
          { type: "ed25519PublicKey" },
          { type: "ecdsaSecp256k1PublicKey" },
          { type: "ecdsaSecp256k1PrivateKey" },
        ],
      });

      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParamsBase,
        adminKey: keyList.key,
        commonTransactionParams: { signers: keyList.privateKeys },
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      await verifyContractKeyList(response.contractId, keyList.key, "adminKey");
    });

    it("(#11) Create a contract with a valid ThresholdKey of ED25519 and ECDSAsecp256k1 private and public keys as its admin key", async function () {
      const thresholdKey = await generateKeyList(this, {
        type: "thresholdKey",
        threshold: 2,
        keys: [
          { type: "ed25519PublicKey" },
          { type: "ecdsaSecp256k1PublicKey" },
          { type: "ecdsaSecp256k1PrivateKey" },
        ],
      });

      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParamsBase,
        adminKey: thresholdKey.key,
        commonTransactionParams: { signers: thresholdKey.privateKeys },
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;
      await verifyContractKeyList(
        response.contractId,
        thresholdKey.key,
        "adminKey",
      );
    });

    it("(#12) Create a contract with a valid key as the admin key but do not sign with it", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          ...commonContractParamsBase,
          adminKey: ed25519PublicKey,
        });
      } catch (err: any) {
        assert.equal(
          err.data.status,
          "INVALID_SIGNATURE",
          "Invalid signature error",
        );
        return;
      }
      assert.fail("Should throw an error");
    });
  });

  describe("Staked Account/Node ID", function () {
    let ed25519PrivateKey: string;
    let ed25519PublicKey: string;
    let commonContractParams: any;

    beforeEach(async function () {
      ed25519PrivateKey = await generateEd25519PrivateKey(this);
      ed25519PublicKey = await generateEd25519PublicKey(
        this,
        ed25519PrivateKey,
      );

      commonContractParams = {
        initcode: smartContractBytecode,
        gas: "300000",
      };
    });

    const verifyContractCreationWithStakedAccountId = async (
      contractId: string,
      stakedAccountId: string,
    ) => {
      // Verify via consensus node
      const contractInfo =
        await consensusInfoClient.getContractInfo(contractId);
      expect(contractInfo.stakingInfo?.stakedAccountId?.toString()).to.equal(
        stakedAccountId,
      );
    };

    const verifyContractCreationWithStakedNodeId = async (
      contractId: string,
      stakedNodeId: string,
    ) => {
      // Verify via consensus node
      const contractInfo =
        await consensusInfoClient.getContractInfo(contractId);
      expect(contractInfo.stakingInfo?.stakedNodeId?.toString()).to.equal(
        stakedNodeId,
      );
    };

    it("(#1) Create a contract that does not have an admin key and is staked to valid account ID", async function () {
      const stakedAccountId = process.env.OPERATOR_ACCOUNT_ID as string;
      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        stakedAccountId,
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;

      await verifyContractCreationWithStakedAccountId(
        response.contractId,
        stakedAccountId,
      );
    });

    it("(#2) Create a contract that does not have an admin key and staked to valid node ID", async function () {
      //not sure if this is valid
      const stakedNodeId = "0";
      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        stakedNodeId,
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;

      await verifyContractCreationWithStakedNodeId(
        response.contractId,
        stakedNodeId,
      );
    });

    it("(#3) Create a contract that does not have an admin key and that has an invalid stakedAccountId", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          ...commonContractParams,
          stakedAccountId: "0.0.99999",
        });
      } catch (err: any) {
        assert.equal(err.data.status, "INVALID_STAKING_ID");
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#4) Create a contract that does not have an admin key and has an invalid stakedNodeId", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          ...commonContractParams,
          stakedNodeId: "9999999",
        });
      } catch (err: any) {
        assert.equal(err.data.status, "INVALID_STAKING_ID");
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#5) Create a contract that does not have an admin key and that tries to set both stakedAccountId and stakedNodeId present", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          ...commonContractParams,
          stakedAccountId: process.env.OPERATOR_ACCOUNT_ID,
          stakedNodeId: "0",
        });
      } catch (err: any) {
        assert.equal(err.data.status, "INVALID_STAKING_ID");
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#6) Create a contract that does have an admin key and is staked to valid account ID", async function () {
      const stakedAccountId = process.env.OPERATOR_ACCOUNT_ID as string;
      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        adminKey: ed25519PublicKey,
        stakedAccountId,
        commonTransactionParams: {
          signers: [ed25519PrivateKey],
        },
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;

      await verifyContractCreationWithStakedAccountId(
        response.contractId,
        stakedAccountId,
      );
    });

    it("(#7) Create a contract that does have an admin key and staked to valid node ID", async function () {
      const stakedNodeId = "0";
      const response = await JSONRPCRequest(this, "createContract", {
        ...commonContractParams,
        adminKey: ed25519PublicKey,
        stakedNodeId,
        commonTransactionParams: {
          signers: [ed25519PrivateKey],
        },
      });

      expect(response.status).to.equal("SUCCESS");
      expect(response.contractId).to.not.be.null;

      await verifyContractCreationWithStakedNodeId(
        response.contractId,
        stakedNodeId,
      );
    });

    it("(#8) Create a contract that does have an admin key and that has an invalid stakedAccountId", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          ...commonContractParams,
          adminKey: ed25519PublicKey,
          stakedAccountId: "0.0.99999",
          commonTransactionParams: {
            signers: [ed25519PrivateKey],
          },
        });
      } catch (err: any) {
        assert.equal(err.data.status, "INVALID_STAKING_ID");
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#9) Create a contract that does have an admin key and has an invalid stakedNodeId", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          ...commonContractParams,
          adminKey: ed25519PublicKey,
          stakedNodeId: "9999999",
          commonTransactionParams: {
            signers: [ed25519PrivateKey],
          },
        });
      } catch (err: any) {
        assert.equal(err.data.status, "INVALID_STAKING_ID");
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#10) Create a contract that does have an admin key and that tries to set both stakedAccountId and stakedNodeId present", async function () {
      try {
        await JSONRPCRequest(this, "createContract", {
          ...commonContractParams,
          adminKey: ed25519PublicKey,
          stakedAccountId: process.env.OPERATOR_ACCOUNT_ID,
          stakedNodeId: "0",
          commonTransactionParams: {
            signers: [ed25519PrivateKey],
          },
        });
      } catch (err: any) {
        assert.equal(err.data.status, "INVALID_STAKING_ID");
        return;
      }

      assert.fail("Should throw an error");
    });

    it("(#11) Create a contract that does have an admin key and that tries to stake to a deleted account ID", async function () {
      // First, create a test account that we can delete
      const testAccountKey = await generateEd25519PrivateKey(this);
      const testAccount = await JSONRPCRequest(this, "createAccount", {
        key: testAccountKey,
        initialBalance: "100000000", // 1 HBAR
      });

      // Delete the test account
      await JSONRPCRequest(this, "deleteAccount", {
        deleteAccountId: testAccount.accountId,
        transferAccountId: process.env.OPERATOR_ACCOUNT_ID,
        commonTransactionParams: {
          signers: [testAccountKey],
        },
      });

      // Wait a moment for the deletion to propagate
      await new Promise((resolve) => setTimeout(resolve, 3000));

      // Now try to create a contract staked to the deleted account
      try {
        await JSONRPCRequest(this, "createContract", {
          ...commonContractParams,
          adminKey: ed25519PublicKey,
          stakedAccountId: testAccount.accountId,
          commonTransactionParams: {
            signers: [ed25519PrivateKey],
          },
        });
      } catch (err: any) {
        // Should fail with an appropriate error
        assert.isTrue(
          err.data.status === "INVALID_STAKING_ID" ||
            err.data.status === "ACCOUNT_DELETED" ||
            err.data.status.includes("STAKING"),
          `Expected staking/deletion error, got: ${err.data.status}`,
        );
        return;
      }

      assert.fail("Should throw an error");
    });
  });
});
